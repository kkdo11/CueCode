apiVersion: apps/v1
kind: Deployment
metadata:
  name: config-server-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: config-server
  template:
    metadata:
      labels:
        app: config-server
    spec:
      containers:
        - name: config-server-app
          image: cuecoderegistry.azurecr.io/spring-config-server:__TAG__
          imagePullPolicy: Always
          env:
            - name: SPRING_PROFILES_ACTIVE
              value: git,json # ë˜ëŠ” "git"
            - name: JAVA_TOOL_OPTIONS
              value: "-Xms256m -Xmx512m"
            - name: SPRING_CLOUD_CONFIG_SERVER_GIT_URI
              value: "https://github.com/CueCode-200OK/CueCode-Config.git"
          ports:
            - containerPort: 8888
          resources:
            requests:
              cpu: "50m"
              memory: "384Mi"
            limits:
              cpu: "100m"
              memory: "768Mi"

          # ğŸš€ [ì¶”ê°€] STARTUP PROBE: ëŠë¦° Spring Boot ì‹œì‘ ì‹œê°„(ìµœëŒ€ 3ë¶„ 20ì´ˆ)ì„ ì»¤ë²„
          startupProbe:
            httpGet:
              path: /actuator/health/readiness
              port: 8888
            initialDelaySeconds: 5
            periodSeconds: 10      # 10ì´ˆë§ˆë‹¤ ê²€ì‚¬
            failureThreshold: 20   # ì´ 3ë¶„ 20ì´ˆ(20 * 10s)ê¹Œì§€ ê¸°ë‹¤ë ¤ ì¤Œ

          # [ìˆ˜ì •] READINESS PROBE: Startup Probeê°€ ëë‚˜ë©´ ì¦‰ì‹œ ì‹œì‘í•˜ë„ë¡ ì§€ì—° ì‹œê°„ ì œê±°
          readinessProbe:
            httpGet:
              path: /actuator/health/readiness
              port: 8888
            initialDelaySeconds: 0 # â¬…ï¸ 0ì´ˆë¡œ ìˆ˜ì • (Startup Probeê°€ ì»¤ë²„)
            periodSeconds: 5
            timeoutSeconds: 3
            failureThreshold: 3

          # [ìˆ˜ì •] LIVENESS PROBE: ìƒì¡´ í™•ì¸
          livenessProbe:
            httpGet:
              path: /actuator/health/liveness
              port: 8888
            initialDelaySeconds: 40 # â¬…ï¸ 40ì´ˆë¡œ ìˆ˜ì • (Startup ì´í›„ ì•ˆì „í•˜ê²Œ ì‹œì‘)
            periodSeconds: 15
            timeoutSeconds: 5
            failureThreshold: 5