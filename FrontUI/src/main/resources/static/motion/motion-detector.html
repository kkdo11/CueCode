<!--<!DOCTYPE html>-->
<!--<html lang="ko">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>CueCode | ì‹¤ì‹œê°„ ë™ì‘ ì¸ì‹</title>-->
<!--    <link rel="shortcut icon" type="image/png" href="../images/logos/favicon.svg" />-->
<!--    <link rel="stylesheet" href="../libs/owl.carousel/dist/assets/owl.carousel.min.css">-->
<!--    <link rel="stylesheet" href="../libs/aos-master/dist/aos.css">-->
<!--    <link rel="stylesheet" href="../css/styles.css" />-->
<!--    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>-->
<!--    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>-->
<!--    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>-->
<!--    <link rel="stylesheet" href="../css/patient/patient.css" />-->
<!--    <style>-->
<!--        /* ======================================================= */-->
<!--        /* UIverse í† ê¸€ ìŠ¤ìœ„ì¹˜ CSS (Start) */-->
<!--        /* ======================================================= */-->
<!--        .checkbox-wrapper-5 .check {-->
<!--            &#45;&#45;size: 40px;-->
<!--            position: relative;-->
<!--            background: linear-gradient(90deg, #19bb85, #9adac4);-->
<!--            line-height: 0;-->
<!--            perspective: 400px;-->
<!--            font-size: var(&#45;&#45;size);-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check input[type="checkbox"],-->
<!--        .checkbox-wrapper-5 .check label,-->
<!--        .checkbox-wrapper-5 .check label::before,-->
<!--        .checkbox-wrapper-5 .check label::after,-->
<!--        .checkbox-wrapper-5 .check {-->
<!--            appearance: none;-->
<!--            display: inline-block;-->
<!--            border-radius: var(&#45;&#45;size);-->
<!--            border: 0;-->
<!--            transition: .35s ease-in-out;-->
<!--            box-sizing: border-box;-->
<!--            cursor: pointer;-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check label {-->
<!--            width: calc(2.2 * var(&#45;&#45;size));-->
<!--            height: var(&#45;&#45;size);-->
<!--            background: #d7d7d7;-->
<!--            overflow: hidden;-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check input[type="checkbox"] {-->
<!--            position: absolute;-->
<!--            z-index: 1;-->
<!--            width: calc(.8 * var(&#45;&#45;size));-->
<!--            height: calc(.8 * var(&#45;&#45;size));-->
<!--            top: calc(.1 * var(&#45;&#45;size));-->
<!--            left: calc(.1 * var(&#45;&#45;size));-->
<!--            background: linear-gradient(45deg, #dedede, #ffffff);-->
<!--            box-shadow: 0 6px 7px rgba(0,0,0,0.3);-->
<!--            outline: none;-->
<!--            margin: 0;-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check input[type="checkbox"]:checked {-->
<!--            left: calc(1.3 * var(&#45;&#45;size));-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check input[type="checkbox"]:checked + label {-->
<!--            background: transparent;-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check label::before,-->
<!--        .checkbox-wrapper-5 .check label::after {-->
<!--            content: "Â· Â·";-->
<!--            position: absolute;-->
<!--            overflow: hidden;-->
<!--            left: calc(.15 * var(&#45;&#45;size));-->
<!--            top: calc(.5 * var(&#45;&#45;size));-->
<!--            height: var(&#45;&#45;size);-->
<!--            letter-spacing: calc(-0.04 * var(&#45;&#45;size));-->
<!--            color: #9b9b9b;-->
<!--            font-family: "Times New Roman", serif;-->
<!--            z-index: 2;-->
<!--            font-size: calc(.6 * var(&#45;&#45;size));-->
<!--            border-radius: 0;-->
<!--            transform-origin: 0 0 calc(-0.5 * var(&#45;&#45;size));-->
<!--            backface-visibility: hidden;-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check label::after {-->
<!--            content: "â—";-->
<!--            top: calc(.65 * var(&#45;&#45;size));-->
<!--            left: calc(.2 * var(&#45;&#45;size));-->
<!--            height: calc(.1 * var(&#45;&#45;size));-->
<!--            width: calc(.35 * var(&#45;&#45;size));-->
<!--            font-size: calc(.2 * var(&#45;&#45;size));-->
<!--            transform-origin: 0 0 calc(-0.4 * var(&#45;&#45;size));-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check input[type="checkbox"]:checked + label::before,-->
<!--        .checkbox-wrapper-5 .check input[type="checkbox"]:checked + label::after {-->
<!--            left: calc(1.55 * var(&#45;&#45;size));-->
<!--            top: calc(.4 * var(&#45;&#45;size));-->
<!--            line-height: calc(.1 * var(&#45;&#45;size));-->
<!--            transform: rotateY(360deg);-->
<!--        }-->

<!--        .checkbox-wrapper-5 .check input[type="checkbox"]:checked + label::after {-->
<!--            height: calc(.16 * var(&#45;&#45;size));-->
<!--            top: calc(.55 * var(&#45;&#45;size));-->
<!--            left: calc(1.6 * var(&#45;&#45;size));-->
<!--            font-size: calc(.6 * var(&#45;&#45;size));-->
<!--            line-height: 0;-->
<!--        }-->
<!--        /* ======================================================= */-->
<!--        /* UIverse í† ê¸€ ìŠ¤ìœ„ì¹˜ CSS (End) */-->
<!--        /* ======================================================= */-->

<!--        /* ğŸ’¡ ë©”ì¸ Flex Containerì— í¬í•¨ë˜ëŠ” ë‘ ì¹´ë“œì˜ ë„ˆë¹„ ì„¤ì • */-->
<!--        .main-flex-area {-->
<!--            align-items: stretch !important; /* ìì‹ ìš”ì†Œì˜ ë†’ì´ë¥¼ ê°•ì œë¡œ ë§ì¶¤ (ì˜¤ë¥¸ìª½ column) */-->
<!--        }-->
<!--        .camera-control-card {-->
<!--            /* ì¹´ë©”ë¼ ì¹´ë“œ: ì „ì²´ ê³µê°„ì˜ ì•½ 65% ì°¨ì§€ */-->
<!--            flex: 0 0 65%;-->
<!--            max-width: 65%;-->
<!--            padding: 20px !important;-->
<!--        }-->
<!--        .right-side-column {-->
<!--            /* ì˜¤ë¥¸ìª½ ì—´: ì „ì²´ ê³µê°„ì˜ ì•½ 30% ì°¨ì§€ */-->
<!--            flex: 0 0 30%;-->
<!--            max-width: 30%;-->
<!--            display: flex; /* ë‚´ë¶€ ìš”ì†Œ ìˆ˜ì§ ì •ë ¬ */-->
<!--            flex-direction: column;-->
<!--        }-->
<!--        .range-select-card {-->
<!--            /* ìƒë‹¨ ì¹´ë“œ */-->
<!--            height: auto;-->
<!--        }-->
<!--        .detected-phrase-card {-->
<!--            /* í•˜ë‹¨ ì¹´ë“œ: ë‚¨ì€ ê³µê°„ì„ ì±„ì›Œ ì „ì²´ ë†’ì´ë¥¼ ì¹´ë©”ë¼ ì¹´ë“œì™€ ë§ì¶¤ */-->
<!--            flex-grow: 1;-->
<!--            display: flex;-->
<!--            flex-direction: column;-->
<!--            justify-content: center; /* ë‚´ë¶€ ì½˜í…ì¸  ì¤‘ì•™ ì •ë ¬ */-->
<!--        }-->

<!--        /* ì¹´ë©”ë¼ ë° ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ */-->
<!--        #container {-->
<!--            position: relative;-->
<!--            display: block;-->
<!--            width: 100%;-->
<!--            max-width: 100%;-->
<!--            height: auto;-->
<!--            aspect-ratio: 4/3;-->
<!--            margin-left: auto;-->
<!--            margin-right: auto;-->
<!--            border: 2px solid #333;-->
<!--            border-radius: 10px;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        #webcam, #output_canvas {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            transform: scaleX(-1);-->
<!--        }-->
<!--        #output_canvas { position: absolute; top: 0; left: 0; }-->

<!--        /* ìƒíƒœ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */-->
<!--        #status {-->
<!--            margin-top: 10px;-->
<!--            color: #555;-->
<!--            font-weight: 600;-->
<!--            text-align: center;-->
<!--            max-width: 100%;-->
<!--            margin-left: auto;-->
<!--            margin-right: auto;-->
<!--        }-->
<!--        #detectionStatus {-->
<!--            font-size: 1.1rem;-->
<!--            min-width: 150px;-->
<!--            text-align: left;-->
<!--        }-->
<!--        .text-running { color: #10B981; }-->
<!--        .text-stopped { color: #EF4444; }-->

<!--        /* ì œì–´ í—¤ë” ì»¨í…Œì´ë„ˆ (í† ê¸€ ìŠ¤ìœ„ì¹˜) */-->
<!--        .control-header {-->
<!--            width: 100%;-->
<!--            margin-left: auto;-->
<!--            margin-right: auto;-->
<!--            justify-content: flex-start !important;-->
<!--            gap: 20px;-->
<!--        }-->

<!--        /* í† ê¸€ ì˜ì—­ */-->
<!--        .detection-toggle-area-inner {-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--        }-->

<!--        /* ğŸ’¡ ê°ì§€ ì˜ì—­ ì„ íƒ ì¹´ë“œ ë²„íŠ¼ ê·¸ë£¹ */-->
<!--        .detect-btns-select {-->
<!--            display: flex;-->
<!--            gap: 12px;-->
<!--            width: 100%;-->
<!--            margin-top: 15px; /* ì œëª©ê³¼ì˜ ê°„ê²© */-->
<!--        }-->

<!--        /* ğŸ’¡ ê°ì§€ ë²„íŠ¼ ê°œë³„ ìŠ¤íƒ€ì¼: ê°€ë¡œ í­ í™•ì¥ ìœ ì§€ */-->
<!--        .detect-btns-select .detect-btn {-->
<!--            padding:8px 14px;-->
<!--            border-radius:8px;-->
<!--            border:1px solid #e0e0e0;-->
<!--            background:#fff;-->
<!--            color:#333;-->
<!--            cursor:pointer;-->
<!--            font-weight:600;-->
<!--            transition: all 0.2s;-->
<!--            flex-grow: 1;-->
<!--            min-width: auto;-->
<!--        }-->
<!--        .detect-btns-select .detect-btn.active { background:#6FC8F8; color:#fff; border-color:#6FC8F8; }-->

<!--        /* ì¸ì‹ëœ ë¬¸ì¥ ì¹´ë“œ ìŠ¤íƒ€ì¼ (flex-grow: 1ë¡œ ë†’ì´ ìë™ í™•ì¥) */-->
<!--        .detected-phrase-card {-->
<!--            padding: 30px !important;-->
<!--            /* ğŸ’¡ ë°°ê²½ìƒ‰ì„ ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ ìˆ˜ì • */-->
<!--            background: linear-gradient(135deg, #6FC8F8 0%, #437de4 100%) !important;-->
<!--            border-radius: 10px;-->
<!--            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);-->
<!--            margin: 0;-->
<!--        }-->
<!--        .detected-phrase-card h5 {-->
<!--            color: rgba(255, 255, 255, 0.8) !important;-->
<!--        }-->
<!--        #detectedPhrase {-->
<!--            font-size: 2.5rem;-->
<!--            font-weight: bold;-->
<!--            color: white;-->
<!--            line-height: 1.2;-->
<!--            /* í•˜ë‹¨ ì¹´ë“œì—ì„œ ë‚¨ì€ ê³µê°„ì„ ì°¨ì§€í•˜ë„ë¡ flex-grow ë° ì¤‘ì•™ ì •ë ¬ */-->
<!--            flex-grow: 1;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--        }-->

<!--        /* ğŸ’¡ ì‘ì€ í™”ë©´ì—ì„œ ìˆ˜ì§ ë°°ì—´ ë˜ë„ë¡ ì¡°ì • (ëª¨ë°”ì¼ ë°˜ì‘í˜•) */-->
<!--        @media (max-width: 991px) {-->
<!--            .camera-control-card, .right-side-column {-->
<!--                flex: 0 0 100%;-->
<!--                max-width: 100%;-->
<!--                margin-bottom: 20px;-->
<!--            }-->
<!--            .right-side-column {-->
<!--                margin-top: 0 !important;-->
<!--            }-->
<!--            .detected-phrase-card {-->
<!--                flex-grow: 0;-->
<!--            }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<header class="header border-4 border-primary border-top position-fixed start-0 top-0 w-100 fixed-header">-->
<!--    <div class="container">-->
<!--        <div class="header-wrapper d-flex align-items-center justify-content-between">-->
<!--            <div class="logo">-->
<!--                <a href="/index.html" class="logo-white">-->
<!--                    <img src="../images/logos/logo-dark.svg" alt="logo" class="img-fluid">-->
<!--                </a>-->
<!--                <a href="/index.html" class="logo-dark">-->
<!--                    <img src="../images/logos/logo-dark.svg" alt="logo" class="img-fluid">-->
<!--                </a>-->
<!--            </div>-->
<!--            <div class="d-flex align-items-center gap-4">-->
<!--                <div class="btn-group">-->
<!--                    <button-->
<!--                            class="btn btn-secondary toggle-menu round-45 p-2 d-flex align-items-center justify-content-center bg-white rounded-circle"-->
<!--                            type="button" data-bs-toggle="dropdown" data-bs-auto-close="true" aria-expanded="false">-->
<!--                        <iconify-icon icon="solar:hamburger-menu-line-duotone" class="menu-icon fs-8 text-dark"></iconify-icon>-->
<!--                    </button>-->
<!--                    <ul class="dropdown-menu dropdown-menu-end p-4">-->
<!--                        <div class="d-flex flex-column gap-6">-->
<!--                            <div class="hstack justify-content-between border-bottom pb-6">-->
<!--                                <p class="mb-0 fs-5 text-dark">Menu</p>-->
<!--                                <button type="button" class="btn-close opacity-75" aria-label="Close"></button>-->
<!--                            </div>-->
<!--                            <div class="d-flex flex-column gap-3">-->
<!--                                <ul class="header-menu list-unstyled mb-0 d-flex flex-column gap-2">-->
<!--                                    <li class="header-item">-->
<!--                                        <a href="index.html" aria-current="true"-->
<!--                                           class="header-link active hstack gap-2 fs-7 fw-bold text-dark"><img-->
<!--                                                src="../images/svgs/secondary-leaf.svg" alt="" width="20" height="20"-->
<!--                                                class="img-fluid animate-spin">í™ˆ</a>-->
<!--                                    </li>-->
<!--                                    <li class="header-item" id="patientMenuItem">-->
<!--                                        <a href="/patient/dashboard.html" class="header-link hstack gap-2 fs-7 fw-bold text-dark" id="patientMenuLink"><img-->
<!--                                                src="../images/svgs/secondary-leaf.svg" alt="" width="20" height="20"-->
<!--                                                class="img-fluid animate-spin">í™˜ì ëŒ€ì‹œë³´ë“œ</a>-->
<!--                                    </li>-->
<!--                                    <li class="header-item" id="managerMenuItem">-->
<!--                                        <a href="../manager/dashboard.html" class="header-link hstack gap-2 fs-7 fw-bold text-dark" id="managerMenuLink"><img-->
<!--                                                src="../images/svgs/secondary-leaf.svg" alt="" width="20" height="20"-->
<!--                                                class="img-fluid animate-spin">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</a>-->
<!--                                    </li>-->
<!--                                    <li class="header-item" id="myPageMenuItem">-->
<!--                                        <a href="../user/mypage.html" class="header-link hstack gap-2 fs-7 fw-bold text-dark" id="myPageMenuLinkAnchor"><img-->
<!--                                                src="../images/svgs/secondary-leaf.svg" alt="" width="20" height="20"-->
<!--                                                class="img-fluid animate-spin">ë§ˆì´ í˜ì´ì§€</a>-->
<!--                                    </li>-->
<!--                                </ul>-->
<!--                                <div class="hstack gap-3" id="auth-btn-group">-->
<!--                                    <a href="sign-in.html"-->
<!--                                       class="btn btn-outline-light fs-6 bg-white px-3 py-2 text-dark w-50 hstack justify-content-center">ë¡œê·¸ì¸</a>-->
<!--                                    <a href="sign-up.html"-->
<!--                                       class="btn btn-dark text-white fs-6 bg-dark px-3 py-2 w-50 hstack justify-content-center">íšŒì›ê°€ì…</a>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </ul>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</header>-->

<!--<div class="container my-5 pt-5">-->

<!--    <div class="row mb-4 justify-content-center">-->
<!--        <div class="col-12 col-md-10 fade-in-up">-->

<!--            <div class="d-flex justify-content-center align-items-start gap-4 flex-wrap flex-lg-nowrap main-flex-area">-->

<!--                <div class="p-3 p-md-5 bg-white rounded shadow camera-control-card">-->

<!--                    <div class="d-flex align-items-center mb-3 control-header">-->
<!--                        <div class="d-flex align-items-center detection-toggle-area-inner">-->
<!--                            <div class="checkbox-wrapper-5">-->
<!--                                <div class="check">-->
<!--                                    <input id="detectionToggle" type="checkbox">-->
<!--                                    <label for="detectionToggle"></label>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <span id="detectionStatus" class="ms-3 fw-bold text-stopped">ë™ì‘ ì¸ì‹ ì •ì§€ ì¤‘</span>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    <div id="container" class="mx-auto">-->
<!--                        <video id="webcam" autoplay playsinline></video>-->
<!--                        <canvas id="output_canvas"></canvas>-->
<!--                    </div>-->

<!--                    <div id="status" class="mt-3">ìƒíƒœ: ì¹´ë©”ë¼ ì—°ê²° ëŒ€ê¸° ì¤‘</div>-->
<!--                </div>-->

<!--                <div class="d-flex flex-column gap-4 right-side-column">-->

<!--                    <div class="p-4 rounded shadow range-select-card">-->
<!--                        <h5 class="mb-3 text-center text-dark fw-bold">ì¸ì‹ ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h5>-->
<!--                        <div class="detect-btns-select" id="detectAreaBtns">-->
<!--                            <button class="detect-btn active" data-value="hands" id="detectHandsBtn">ì†</button>-->
<!--                            <button class="detect-btn" data-value="face" id="detectFaceBtn">ì–¼êµ´</button>-->
<!--                            <button class="detect-btn" data-value="eyes" id="detectEyesBtn">ëˆˆ</button>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    <div class="p-4 bg-primary rounded shadow text-white detected-phrase-card">-->
<!--                        <h5 class="mb-2 text-center text-white-75">ì¸ì‹ëœ ë¬¸ì¥</h5>-->
<!--                        <div id="detectedPhrase" class="text-center">ì¸ì‹ ëŒ€ê¸° ì¤‘</div>-->
<!--                    </div>-->

<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->
<!--<footer class="footer bg-dark py-5 py-lg-11 py-xl-5">-->
<!--    <div class="container">-->
<!--        <div class="row">-->
<!--            <div class="col-xl-5 mb-8 mb-xl-0">-->
<!--                <div class="d-flex flex-column gap-8 pe-xl-5">-->
<!--                    <h4 class="mb-0 text-white">ì´ í”„ë¡œì íŠ¸ëŠ” <br> 2025 ìƒˆì‹¹ í•´ì»¤í†¤-->
<!--                        <br>ê³µëª¨ì „ ì¶œí’ˆì‘ì…ë‹ˆë‹¤</h4>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="col-md-6 col-xl-4 mb-8 mb-xl-0">-->
<!--                <div class="d-flex flex-column gap-2">-->
<!--                    <a href="https://dacon.io/competitions/official/236624/overview/description" target="_blank" class="link-hover hstack gap-3 text-white fs-5">-->
<!--                        <iconify-icon icon="lucide:arrow-up-right" class="fs-7 text-primary"></iconify-icon>-->
<!--                        https://dacon.io/competitions/official/236624/overview/description-->
<!--                    </a>-->
<!--                    <a href="https://buly.kr/Awg81rV" target="_blank"-->
<!--                       class="link-hover hstack gap-3 text-white fs-5">-->
<!--                        <iconify-icon icon="lucide:map-pin" class="fs-7 text-primary"></iconify-icon>-->
<!--                        200ok-->
<!--                    </a>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="col-md-4 col-xl-3 mb-8 mb-xl-0">-->
<!--                <p class="mb-0 text-white text-opacity-70 text-md-end">Â© CueCode copyright 2025</p>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
<!--    <p class="mb-0 text-white text-opacity-70 text-md-center mt-10">Distributed by <a class="text-white"  target="_blank">Team Ujangsan Spirit</a></p>-->
<!--</footer>-->
<!--<div class="get-template hstack gap-2">-->
<!--    <button class="btn bg-primary p-2 round-52 rounded-circle hstack justify-content-center flex-shrink-0"-->
<!--            id="scrollToTopBtn">-->
<!--        <iconify-icon icon="lucide:arrow-up" class="fs-7 text-dark"></iconify-icon>-->
<!--    </button>-->
<!--</div>-->


<!--<script src="../js/user/index.js"></script>-->
<!--<script src="../js/config.js"></script>-->
<!--<script src="../libs/jquery/dist/jquery.min.js"></script>-->
<!--<script src="../libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>-->
<!--<script src="../libs/owl.carousel/dist/owl.carousel.min.js"></script>-->
<!--<script src="../libs/aos-master/dist/aos.js"></script>-->

<!--<script type="module" src="/vendor/mediapipe/js/vision_bundle.js"></script>-->

<!--<script type="module">-->
<!--    // MotionLink Demo v0.6ì˜ JavaScript ì½”ë“œ + CueCode í† ê¸€ ìŠ¤ìœ„ì¹˜ ì—°ë™ ë¡œì§-->

<!--    // Pick the correct backend port!-->
<!--    // const WEBSOCKET_URL = "ws://localhost:8000/ws/motion";-->
<!--    //const WEBSOCKET_URL = "ws://localhost:13000/ws/motion";-->
<!--    const WEBSOCKET_URL = "ws://localhost:15000/ws/motion";-->

<!--    const SEND_INTERVAL_MS = 100;-->
<!--    const SEGMENT_MS = 1000; // send "end" every 1s while streaming-->
<!--    let lastSegmentTs = 0;-->

<!--    const video = document.getElementById("webcam");-->
<!--    const canvasElement = document.getElementById("output_canvas");-->
<!--    const canvasCtx = canvasElement.getContext("2d");-->

<!--    // MotionLink ë‚´ë¶€ ìƒíƒœ ë©”ì‹œì§€ (Detailed)-->
<!--    const statusDiv = document.getElementById("status");-->
<!--    // CueCode UI ìƒë‹¨ ë™ì‘ ì¸ì‹ ìƒíƒœ í…ìŠ¤íŠ¸ (UI/Styling)-->
<!--    const detectionStatusSpan = document.getElementById("detectionStatus");-->
<!--    // CueCode í† ê¸€ ìŠ¤ìœ„ì¹˜ ìš”ì†Œ-->
<!--    const toggle = document.getElementById('detectionToggle');-->

<!--    const phraseDiv = document.getElementById("detectedPhrase");-->


<!--    const { FaceLandmarker, HandLandmarker, FilesetResolver, DrawingUtils } =-->
<!--        await import("/vendor/mediapipe/js/vision_bundle.js");-->

<!--    let faceLandmarker, handLandmarker, drawingUtils, socket;-->
<!--    let detectionActive = false;-->
<!--    let lastVideoTime = -1, lastSendTime = 0;-->
<!--    let selectedDetectionArea = 'hands'; // 'hands' | 'face' | 'eyes'-->

<!--    function getNormalizedDetectionArea(raw) {-->
<!--        if (!raw) return 'hand';-->
<!--        if (raw === 'hands') return 'hand';-->
<!--        return 'face'; // treat face/eyes the same for backend-->
<!--    }-->

<!--    function sendEnd(area = getNormalizedDetectionArea(selectedDetectionArea)) {-->
<!--        if (socket && socket.readyState === WebSocket.OPEN) {-->
<!--            socket.send(JSON.stringify({ type: "end", detectionArea: area }));-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * UI ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. (í† ê¸€, ìƒë‹¨ í…ìŠ¤íŠ¸, ìƒ‰ìƒ)-->
<!--     * @param {boolean} isRunning - ì¸ì‹ì´ ì‹¤í–‰ ì¤‘ì¸ì§€ ì—¬ë¶€-->
<!--     */-->
<!--    function setUIStatus(isRunning) {-->
<!--        toggle.checked = isRunning;-->
<!--        if (isRunning) {-->
<!--            detectionStatusSpan.textContent = "ë™ì‘ ì¸ì‹ ì¤‘";-->
<!--            detectionStatusSpan.classList.remove('text-stopped');-->
<!--            detectionStatusSpan.classList.add('text-running');-->
<!--        } else {-->
<!--            detectionStatusSpan.textContent = "ë™ì‘ ì¸ì‹ ì •ì§€ ì¤‘";-->
<!--            detectionStatusSpan.classList.remove('text-running');-->
<!--            detectionStatusSpan.classList.add('text-stopped');-->
<!--        }-->
<!--    }-->

<!--    function setupDetectAreaButtons() {-->
<!--        const container = document.getElementById('detectAreaBtns');-->
<!--        if (!container) return;-->
<!--        container.querySelectorAll('.detect-btn').forEach(btn => {-->
<!--            btn.addEventListener('click', () => {-->
<!--                const prevArea = getNormalizedDetectionArea(selectedDetectionArea);-->
<!--                container.querySelectorAll('.detect-btn').forEach(b => b.classList.remove('active'));-->
<!--                btn.classList.add('active');-->
<!--                selectedDetectionArea = btn.dataset.value || 'hands';-->
<!--                const nextArea = getNormalizedDetectionArea(selectedDetectionArea);-->
<!--                // When switching modes, close the current segment explicitly-->
<!--                if (detectionActive && prevArea !== nextArea) {-->
<!--                    sendEnd(prevArea);-->
<!--                    lastSegmentTs = performance.now();-->
<!--                }-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    async function createLandmarkers() {-->
<!--        const vision = await FilesetResolver.forVisionTasks("/vendor/mediapipe/wasm");-->
<!--        drawingUtils = new DrawingUtils(canvasCtx);-->
<!--        faceLandmarker = await FaceLandmarker.createFromOptions(vision, {-->
<!--            baseOptions: { modelAssetPath: `/vendor/mediapipe/models/face_landmarker.task`, delegate: "GPU" },-->
<!--            outputFaceBlendshapes: true,-->
<!--            runningMode: "VIDEO",-->
<!--            numFaces: 1-->
<!--        });-->
<!--        handLandmarker = await HandLandmarker.createFromOptions(vision, {-->
<!--            baseOptions: { modelAssetPath: `/vendor/mediapipe/models/hand_landmarker.task`, delegate: "GPU" },-->
<!--            runningMode: "VIDEO",-->
<!--            numHands: 2-->
<!--        });-->
<!--        statusDiv.textContent = "ìƒíƒœ: ì›¹ìº  ë¡œë”© ì¤‘...";-->
<!--    }-->

<!--    function enableCam() {-->
<!--        navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {-->
<!--            video.srcObject = stream;-->
<!--            video.addEventListener("loadeddata", predictWebcam);-->
<!--            statusDiv.textContent = "ìƒíƒœ: ì›¹ìº  í™œì„±í™”ë¨";-->
<!--        }).catch((err) => {-->
<!--            statusDiv.textContent = "ì˜¤ë¥˜: ì›¹ìº  ì ‘ê·¼ ì‹¤íŒ¨";-->
<!--            console.error(err);-->
<!--        });-->
<!--    }-->

<!--    async function predictWebcam() {-->
<!--        // Keep canvas in sync with video-->
<!--        if (canvasElement.width !== video.videoWidth || canvasElement.height !== video.videoHeight) {-->
<!--            canvasElement.width = video.videoWidth || 640;-->
<!--            canvasElement.height = video.videoHeight || 480;-->
<!--        }-->

<!--        const nowPerf = performance.now();-->

<!--        if (lastVideoTime !== video.currentTime && detectionActive) {-->
<!--            lastVideoTime = video.currentTime;-->

<!--            // Run detectors-->
<!--            const faceResults = faceLandmarker.detectForVideo(video, nowPerf);-->
<!--            const handResults = handLandmarker.detectForVideo(video, nowPerf);-->

<!--            // Draw results-->
<!--            canvasCtx.save();-->
<!--            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);-->

<!--            if (handResults.landmarks) {-->
<!--                for (const landmarks of handResults.landmarks) {-->
<!--                    drawingUtils.drawConnectors(landmarks, HandLandmarker.HAND_CONNECTIONS, { color: "#FFFFFF", lineWidth: 2 });-->
<!--                    drawingUtils.drawLandmarks(landmarks, { color: "#FF0000", lineWidth: 1 });-->
<!--                }-->
<!--            }-->
<!--            if (faceResults.faceLandmarks) {-->
<!--                for (const landmarks of faceResults.faceLandmarks) {-->
<!--                    drawingUtils.drawConnectors(landmarks, FaceLandmarker.FACE_LANDMARKS_TESSELATION, { color: "#C0C0C070", lineWidth: 1 });-->
<!--                }-->
<!--            }-->
<!--            canvasCtx.restore();-->

<!--            // Throttle frame sending-->
<!--            if (nowPerf - lastSendTime > SEND_INTERVAL_MS) {-->
<!--                lastSendTime = nowPerf;-->
<!--                processAndSend(faceResults, handResults);-->
<!--            }-->

<!--            // Periodic segment boundary-->
<!--            if (nowPerf - lastSegmentTs > SEGMENT_MS) {-->
<!--                sendEnd();-->
<!--                lastSegmentTs = nowPerf;-->
<!--            }-->
<!--        }-->

<!--        window.requestAnimationFrame(predictWebcam);-->
<!--    }-->

<!--    function processAndSend(faceResults, handResults) {-->
<!--        const faceBlendshapes = faceResults.faceBlendshapes.length > 0-->
<!--            ? Object.fromEntries(faceResults.faceBlendshapes[0].categories.map(c => [c.categoryName, c.score]))-->
<!--            : {};-->

<!--        const getHandData = (handednesses, landmarks, handName) => {-->
<!--            if (!handednesses || !landmarks) return null;-->
<!--            const idx = handednesses.findIndex(h => (h[0] && h[0].categoryName) === handName);-->
<!--            return idx > -1 ? landmarks[idx].map(p => [p.x, p.y, p.z]) : null;-->
<!--        };-->

<!--        const frame = {-->
<!--            timestamp_ms: Date.now(),-->
<!--            face_blendshapes: faceBlendshapes,-->
<!--            left_hand_landmarks: getHandData(handResults.handednesses, handResults.landmarks, "Left"),-->
<!--            right_hand_landmarks: getHandData(handResults.handednesses, handResults.landmarks, "Right")-->
<!--        };-->

<!--        if (!socket || socket.readyState !== WebSocket.OPEN) return;-->

<!--        const normalizedArea = getNormalizedDetectionArea(selectedDetectionArea);-->
<!--        let features = null;-->

<!--        if (normalizedArea === 'face') {-->
<!--            if (Object.keys(faceBlendshapes).length === 0) return;-->
<!--            const featureKeys = Object.keys(faceBlendshapes).sort();-->
<!--            features = featureKeys.map(k => Number(faceBlendshapes[k] || 0));-->

<!--            socket.send(JSON.stringify({-->
<!--                type: "frame",-->
<!--                detectionArea: normalizedArea,-->
<!--                timestamp_ms: frame.timestamp_ms,-->
<!--                featureKeys: featureKeys,-->
<!--                features: features-->
<!--            }));-->
<!--        } else { // hand-->
<!--            const right = frame.right_hand_landmarks || null;-->
<!--            const left = frame.left_hand_landmarks || null;-->
<!--            if ((!Array.isArray(right) || right.length === 0) && (!Array.isArray(left) || left.length === 0)) {-->
<!--                return;-->
<!--            }-->
<!--            const pointCount = Math.max((right && right.length) || 0, (left && left.length) || 0);-->
<!--            const vec = [];-->
<!--            for (let i = 0; i < pointCount; i++) {-->
<!--                if (right && right[i] && right[i].length >= 3) { vec.push(+right[i][0]||0, +right[i][1]||0, +right[i][2]||0); }-->
<!--                else { vec.push(0,0,0); }-->
<!--            }-->
<!--            for (let i = 0; i < pointCount; i++) {-->
<!--                if (left && left[i] && left[i].length >= 3) { vec.push(+left[i][0]||0, +left[i][1]||0, +left[i][2]||0); }-->
<!--                else { vec.push(0,0,0); }-->
<!--            }-->
<!--            features = vec;-->

<!--            socket.send(JSON.stringify({-->
<!--                type: "frame",-->
<!--                detectionArea: normalizedArea,-->
<!--                timestamp_ms: frame.timestamp_ms,-->
<!--                features: features-->
<!--            }));-->
<!--        }-->
<!--    }-->

<!--    function getCookie(name) {-->
<!--        const value = `; ${document.cookie}`;-->
<!--        const parts = value.split(`; ${name}=`);-->
<!--        if (parts.length === 2) return parts.pop().split(';').shift();-->
<!--    }-->

<!--    function speak(text) {-->
<!--        if ('speechSynthesis' in window) {-->
<!--            const utterance = new SpeechSynthesisUtterance(text);-->
<!--            utterance.lang = 'ko-KR';-->
<!--            window.speechSynthesis.speak(utterance);-->
<!--        }-->
<!--    }-->

<!--    function initWebSocket() {-->
<!--        const token = getCookie('jwtAccessToken');-->
<!--        const url = token ? `${WEBSOCKET_URL}?token=${encodeURIComponent(token)}` : WEBSOCKET_URL;-->

<!--        socket = new WebSocket(url);-->
<!--        socket.onopen = () => {-->
<!--            detectionActive = true;-->
<!--            lastSegmentTs = performance.now();-->

<!--            // -&#45;&#45; UI Bridge: Start ìƒíƒœ ì—…ë°ì´íŠ¸ -&#45;&#45;-->
<!--            phraseDiv.textContent = "-";-->
<!--            statusDiv.textContent = "ìƒíƒœ: ì„œë²„ ì—°ê²°ë¨ (ì¸ì‹ ì¤‘)";-->
<!--            setUIStatus(true); // í† ê¸€ê³¼ ìƒë‹¨ í…ìŠ¤íŠ¸ë¥¼ "ì¸ì‹ ì¤‘"ìœ¼ë¡œ ì—…ë°ì´íŠ¸-->
<!--            // &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
<!--        };-->
<!--        socket.onmessage = (event) => {-->
<!--            try {-->
<!--                const data = JSON.parse(event.data);-->
<!--                if (data.type === "match") {-->
<!--                    const phrase = data.matched && data.phrase ? data.phrase : "ì¸ì‹ëœ ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤.";-->
<!--                    phraseDiv.textContent = phrase;-->
<!--                    if (data.matched && data.phrase) speak(data.phrase);-->
<!--                }-->
<!--            } catch {-->
<!--                phraseDiv.textContent = "ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜";-->
<!--            }-->
<!--        };-->
<!--        socket.onerror = () => {-->
<!--            // Try to close the current segment before closing the socket-->
<!--            sendEnd();-->
<!--            if (socket && socket.readyState === WebSocket.OPEN) socket.close();-->
<!--            phraseDiv.textContent = "WebSocket ì˜¤ë¥˜";-->
<!--        };-->
<!--        socket.onclose = () => {-->
<!--            detectionActive = false;-->

<!--            // -&#45;&#45; UI Bridge: Stop ìƒíƒœ ì—…ë°ì´íŠ¸ -&#45;&#45;-->
<!--            statusDiv.textContent = "ìƒíƒœ: ì—°ê²° ì¢…ë£Œë¨";-->
<!--            setUIStatus(false); // í† ê¸€ê³¼ ìƒë‹¨ í…ìŠ¤íŠ¸ë¥¼ "ì •ì§€ ì¤‘"ìœ¼ë¡œ ì—…ë°ì´íŠ¸-->
<!--            // &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
<!--        };-->
<!--    }-->


<!--    // -&#45;&#45; í† ê¸€ ìŠ¤ìœ„ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: UI ë° ê¸°ëŠ¥ ì—°ë™ -&#45;&#45;-->
<!--    if (toggle) {-->
<!--        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ ì„¤ì • (unchecked = ì •ì§€ ì¤‘)-->
<!--        setUIStatus(toggle.checked);-->

<!--        toggle.addEventListener('change', (event) => {-->
<!--            const isChecked = event.target.checked;-->

<!--            // 1. UI ìƒíƒœë¥¼ ì¦‰ì‹œ ì—…ë°ì´íŠ¸-->
<!--            setUIStatus(isChecked);-->

<!--            if (isChecked) {-->
<!--                // í† ê¸€ ì¼œì§: ë™ì‘ ì¸ì‹ ì‹œì‘-->
<!--                if (!socket || socket.readyState === WebSocket.CLOSED) {-->
<!--                    initWebSocket();-->
<!--                }-->
<!--            } else {-->
<!--                // í† ê¸€ êº¼ì§: ë™ì‘ ì¸ì‹ ì¢…ë£Œ-->
<!--                if (socket && socket.readyState === WebSocket.OPEN) {-->
<!--                    detectionActive = false;-->
<!--                    sendEnd();-->
<!--                    socket.close();-->
<!--                }-->
<!--            }-->
<!--        });-->
<!--    }-->
<!--    // &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->


<!--    // Also close segment on page hide/unload-->
<!--    window.addEventListener('visibilitychange', () => {-->
<!--        if (document.hidden) sendEnd();-->
<!--    });-->
<!--    window.addEventListener('beforeunload', () => {-->
<!--        sendEnd();-->
<!--    });-->

<!--    // === initialize ===-->
<!--    await createLandmarkers();-->
<!--    enableCam();-->
<!--    setupDetectAreaButtons();-->
<!--</script>-->
<!--<script src="../js/custom.js"></script>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CueCode | ì‹¤ì‹œê°„ ë™ì‘ ì¸ì‹</title>
    <link rel="shortcut icon" type="image/png" href="../images/logos/favicon.svg" />
    <link rel="stylesheet" href="../libs/owl.carousel/dist/assets/owl.carousel.min.css">
    <link rel="stylesheet" href="../libs/aos-master/dist/aos.css">
    <link rel="stylesheet" href="../css/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
    <link rel="stylesheet" href="../css/patient/patient.css" />
    <style>
        /* ======================================================= */
        /* UIverse í† ê¸€ ìŠ¤ìœ„ì¹˜ CSS (Start) */
        /* ======================================================= */
        .checkbox-wrapper-5 .check {
            --size: 40px;
            position: relative;
            background: linear-gradient(90deg, #19bb85, #9adac4);
            line-height: 0;
            perspective: 400px;
            font-size: var(--size);
        }

        .checkbox-wrapper-5 .check input[type="checkbox"],
        .checkbox-wrapper-5 .check label,
        .checkbox-wrapper-5 .check label::before,
        .checkbox-wrapper-5 .check label::after,
        .checkbox-wrapper-5 .check {
            appearance: none;
            display: inline-block;
            border-radius: var(--size);
            border: 0;
            transition: .35s ease-in-out;
            box-sizing: border-box;
            cursor: pointer;
        }

        .checkbox-wrapper-5 .check label {
            width: calc(2.2 * var(--size));
            height: var(--size);
            background: #d7d7d7;
            overflow: hidden;
        }

        .checkbox-wrapper-5 .check input[type="checkbox"] {
            position: absolute;
            z-index: 1;
            width: calc(.8 * var(--size));
            height: calc(.8 * var(--size));
            top: calc(.1 * var(--size));
            left: calc(.1 * var(--size));
            background: linear-gradient(45deg, #dedede, #ffffff);
            box-shadow: 0 6px 7px rgba(0,0,0,0.3);
            outline: none;
            margin: 0;
        }

        .checkbox-wrapper-5 .check input[type="checkbox"]:checked {
            left: calc(1.3 * var(--size));
        }

        .checkbox-wrapper-5 .check input[type="checkbox"]:checked + label {
            background: transparent;
        }

        .checkbox-wrapper-5 .check label::before,
        .checkbox-wrapper-5 .check label::after {
            content: "Â· Â·";
            position: absolute;
            overflow: hidden;
            left: calc(.15 * var(--size));
            top: calc(.5 * var(--size));
            height: var(--size);
            letter-spacing: calc(-0.04 * var(--size));
            color: #9b9b9b;
            font-family: "Times New Roman", serif;
            z-index: 2;
            font-size: calc(.6 * var(--size));
            border-radius: 0;
            transform-origin: 0 0 calc(-0.5 * var(--size));
            backface-visibility: hidden;
        }

        .checkbox-wrapper-5 .check label::after {
            content: "â—";
            top: calc(.65 * var(--size));
            left: calc(.2 * var(--size));
            height: calc(.1 * var(--size));
            width: calc(.35 * var(--size));
            font-size: calc(.2 * var(--size));
            transform-origin: 0 0 calc(-0.4 * var(--size));
        }

        .checkbox-wrapper-5 .check input[type="checkbox"]:checked + label::before,
        .checkbox-wrapper-5 .check input[type="checkbox"]:checked + label::after {
            left: calc(1.55 * var(--size));
            top: calc(.4 * var(--size));
            line-height: calc(.1 * var(--size));
            transform: rotateY(360deg);
        }

        .checkbox-wrapper-5 .check input[type="checkbox"]:checked + label::after {
            height: calc(.16 * var(--size));
            top: calc(.55 * var(--size));
            left: calc(1.6 * var(--size));
            font-size: calc(.6 * var(--size));
            line-height: 0;
        }
        /* ======================================================= */
        /* UIverse í† ê¸€ ìŠ¤ìœ„ì¹˜ CSS (End) */
        /* ======================================================= */

        /* ğŸ’¡ ë©”ì¸ Flex Containerì— í¬í•¨ë˜ëŠ” ë‘ ì¹´ë“œì˜ ë„ˆë¹„ ì„¤ì • */
        .main-flex-area {
            align-items: stretch !important; /* ìì‹ ìš”ì†Œì˜ ë†’ì´ë¥¼ ê°•ì œë¡œ ë§ì¶¤ (ì˜¤ë¥¸ìª½ column) */
        }
        .camera-control-card {
            /* ì¹´ë©”ë¼ ì¹´ë“œ: ì „ì²´ ê³µê°„ì˜ ì•½ 65% ì°¨ì§€ */
            flex: 0 0 65%;
            max-width: 65%;
            padding: 20px !important;
        }
        .right-side-column {
            /* ì˜¤ë¥¸ìª½ ì—´: ì „ì²´ ê³µê°„ì˜ ì•½ 30% ì°¨ì§€ */
            flex: 0 0 30%;
            max-width: 30%;
            display: flex; /* ë‚´ë¶€ ìš”ì†Œ ìˆ˜ì§ ì •ë ¬ */
            flex-direction: column;
        }
        .range-select-card {
            /* ìƒë‹¨ ì¹´ë“œ */
            height: auto;
        }
        .detected-phrase-card {
            /* í•˜ë‹¨ ì¹´ë“œ: ë‚¨ì€ ê³µê°„ì„ ì±„ì›Œ ì „ì²´ ë†’ì´ë¥¼ ì¹´ë©”ë¼ ì¹´ë“œì™€ ë§ì¶¤ */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center; /* ë‚´ë¶€ ì½˜í…ì¸  ì¤‘ì•™ ì •ë ¬ */
        }

        /* ì¹´ë©”ë¼ ë° ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ */
        #container {
            position: relative;
            display: block;
            width: 100%;
            max-width: 100%;
            height: auto;
            aspect-ratio: 4/3;
            margin-left: auto;
            margin-right: auto;
            border: 2px solid #333;
            border-radius: 10px;
            overflow: hidden;
        }
        #webcam, #output_canvas {
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
        }
        #output_canvas { position: absolute; top: 0; left: 0; }

        /* ìƒíƒœ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        #status {
            margin-top: 10px;
            color: #555;
            font-weight: 600;
            text-align: center;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
        }
        #detectionStatus {
            font-size: 1.1rem;
            min-width: 150px;
            text-align: left;
        }
        .text-running { color: #10B981; }
        .text-stopped { color: #EF4444; }

        /* ì œì–´ í—¤ë” ì»¨í…Œì´ë„ˆ (í† ê¸€ ìŠ¤ìœ„ì¹˜) */
        .control-header {
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            justify-content: space-between !important; /* ìˆ˜ì •: ì–‘ìª½ ëìœ¼ë¡œ ë°°ì¹˜ */
            gap: 20px;
        }

        /* í† ê¸€ ì˜ì—­ */
        .detection-toggle-area-inner {
            display: flex;
            align-items: center;
        }

        /* ğŸ’¡ ê°ì§€ ì˜ì—­ ì„ íƒ ì¹´ë“œ ë²„íŠ¼ ê·¸ë£¹ */
        .detect-btns-select {
            display: flex;
            gap: 12px;
            width: 100%;
            margin-top: 15px; /* ì œëª©ê³¼ì˜ ê°„ê²© */
        }

        /* ğŸ’¡ ê°ì§€ ë²„íŠ¼ ê°œë³„ ìŠ¤íƒ€ì¼: ê°€ë¡œ í­ í™•ì¥ ìœ ì§€ */
        .detect-btns-select .detect-btn {
            padding:8px 14px;
            border-radius:8px;
            border:1px solid #e0e0e0;
            background:#fff;
            color:#333;
            cursor:pointer;
            font-weight:600;
            transition: all 0.2s;
            flex-grow: 1;
            min-width: auto;
        }
        .detect-btns-select .detect-btn.active { background:#6FC8F8; color:#fff; border-color:#6FC8F8; }

        /* ì¸ì‹ëœ ë¬¸ì¥ ì¹´ë“œ ìŠ¤íƒ€ì¼ (flex-grow: 1ë¡œ ë†’ì´ ìë™ í™•ì¥) */
        .detected-phrase-card {
            padding: 30px !important;
            /* ğŸ’¡ ë°°ê²½ìƒ‰ì„ ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ ìˆ˜ì • */
            background: linear-gradient(135deg, #6FC8F8 0%, #437de4 100%) !important;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 0;
        }
        .detected-phrase-card h5 {
            color: rgba(255, 255, 255, 0.8) !important;
        }
        #detectedPhrase, #generatedSentence{
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            line-height: 1.2;
            /* í•˜ë‹¨ ì¹´ë“œì—ì„œ ë‚¨ì€ ê³µê°„ì„ ì°¨ì§€í•˜ë„ë¡ flex-grow ë° ì¤‘ì•™ ì •ë ¬ */
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ğŸ’¡ ì‘ì€ í™”ë©´ì—ì„œ ìˆ˜ì§ ë°°ì—´ ë˜ë„ë¡ ì¡°ì • (ëª¨ë°”ì¼ ë°˜ì‘í˜•) */
        @media (max-width: 991px) {
            .camera-control-card, .right-side-column {
                flex: 0 0 100%;
                max-width: 100%;
                margin-bottom: 20px;
            }
            .right-side-column {
                margin-top: 0 !important;
            }
            .detected-phrase-card {
                flex-grow: 0;
            }
        }

        /* ======================================================= */
        /* ë‚˜ì˜ ë™ì‘ ì‚¬ì „ ë²„íŠ¼ CSS (Start) */
        /* ======================================================= */
        .Documents-btn {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            width: fit-content;
            height: 45px;
            border: none;
            padding: 0px 15px;
            border-radius: 5px;
            background-color: rgb(31, 42, 46);
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        /* SVG ì»¨í…Œì´ë„ˆì˜ ì¤‘ì•™ ì •ë ¬ì„ ëª…ì‹œì ìœ¼ë¡œ ê°•í™” */
        .folderContainer {
            width: 40px;
            height: fit-content;
            display: flex;
            flex-direction: column;
            align-items: center; /* ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
            justify-content: flex-end;
            position: relative;
        }
        .fileBack {
            z-index: 1;
            width: 80%;
            height: auto;
        }
        .filePage {
            width: 50%;
            height: auto;
            position: absolute;
            z-index: 2;
            transition: all 0.3s ease-out;
        }
        .fileFront {
            width: 85%;
            height: auto;
            position: absolute;
            z-index: 3;
            opacity: 0.95;
            transform-origin: bottom;
            transition: all 0.3s ease-out;
        }
        .text {
            color: white;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
            margin: 0; /* ë¸Œë¼ìš°ì € ê¸°ë³¸ ë§ˆì§„ ì œê±° */
            /* line-height: 1.2; /* í•„ìš”ì‹œ í…ìŠ¤íŠ¸ ë†’ì´ ì¡°ì • */
        }
        .Documents-btn:hover .filePage {
            transform: translateY(-5px);
        }
        .Documents-btn:hover {
            background-color: rgb(58, 58, 94);
        }
        .Documents-btn:active {
            transform: scale(0.95);
        }
        .Documents-btn:hover .fileFront {
            transform: rotateX(30deg);
        }
        /* ======================================================= */
        /* ë‚˜ì˜ ë™ì‘ ì‚¬ì „ ë²„íŠ¼ CSS (End) */
        /* ======================================================= */


        /* ======================================================= */
        /* ëª¨ë‹¬ ë‚´ë¶€ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ (ì¶”ê°€) */
        /* ======================================================= */
        .user-controls {
            display: none; /* ë™ì‘ ìƒˆë¡œê³ ì¹¨, ëª¨ë“  ë™ì‘ ì‚­ì œ ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
        }

        .user-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .user-input input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            min-width: 200px;
            transition: border-color 0.2s;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background-color: #6FC8F8; /* CueCode ë©”ì¸ ì»¬ëŸ¬ì™€ ìœ ì‚¬í•˜ê²Œ ë³€ê²½ */
            color: white;
        }

        .btn-primary:hover {
            background-color: #437de4;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        /* --- Tab Styles --- */
        .tab-container {
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
        }

        .tab-buttons {
            display: flex;
            background-color: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            border-radius: 8px 8px 0 0;
        }

        .tab-button {
            flex-grow: 1;
            padding: 15px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            border: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            text-align: center;
            background: transparent;
        }

        .tab-button.active {
            color: #437de4; /* CueCode ë¸”ë£¨ ê³„ì—´ */
            background-color: white;
            border-bottom: 3px solid #6FC8F8;
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.05);
        }

        .tab-button:hover:not(.active) {
            background-color: #f1f3f5;
            color: #343a40;
        }

        .tab-content {
            padding: 20px;
            background: white;
            border-radius: 0 0 8px 8px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }
        /* --- End Tab Styles --- */

        .motion-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .motion-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background: #fff;
        }

        .motion-details {
            flex-grow: 1;
        }

        .phrase {
            font-size: 18px;
            font-weight: bold;
            color: #343a40;
            margin-bottom: 5px;
        }

        .description {
            color: #6c757d;
            font-size: 14px;
            line-height: 1.4;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }

        .stats {
            display: flex;
            justify-content: center; /* ê°€ìš´ë° ì •ë ¬ */
            gap: 30px;
            margin-bottom: 20px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 8px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #495057;
        }

        .stat-label {
            font-size: 14px;
            color: #6c757d;
        }



        .visually-hidden {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }
        /* ======================================================= */
        /* ëª¨ë‹¬ ë‚´ë¶€ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ (End) */
        /* ======================================================= */

        /*#generatedSentence {*/
        /*    font-size: 1.4rem;*/
        /*    font-weight: 600;*/
        /*    color: #e5f3ff;*/
        /*    line-height: 1.4;*/
        /*    margin-top: 4px;*/
        /*}*/
    </style>
</head>
<body>
<header class="header border-4 border-primary border-top position-fixed start-0 top-0 w-100 fixed-header">
    <div class="container">
        <div class="header-wrapper d-flex align-items-center justify-content-between">
            <div class="logo">
                <a href="/index.html" class="logo-white">
                    <img src="../images/logos/logo-dark.svg" alt="logo" class="img-fluid">
                </a>
                <a href="/index.html" class="logo-dark">
                    <img src="../images/logos/logo-dark.svg" alt="logo" class="img-fluid">
                </a>
            </div>
            <div class="d-flex align-items-center gap-4">
                <div class="btn-group">
                    <button
                            class="btn btn-secondary toggle-menu round-45 p-2 d-flex align-items-center justify-content-center bg-white rounded-circle"
                            type="button" data-bs-toggle="dropdown" data-bs-auto-close="true" aria-expanded="false">
                        <iconify-icon icon="solar:hamburger-menu-line-duotone" class="menu-icon fs-8 text-dark"></iconify-icon>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end p-4">
                        <div class="d-flex flex-column gap-6">
                            <div class="hstack justify-content-between border-bottom pb-6">
                                <p class="mb-0 fs-5 text-dark">Menu</p>
                                <button type="button" class="btn-close opacity-75" aria-label="Close"></button>
                            </div>
                            <div class="d-flex flex-column gap-3">
                                <ul class="header-menu list-unstyled mb-0 d-flex flex-column gap-2">
                                    <li class="header-item">
                                        <a href="index.html" aria-current="true"
                                           class="header-link active hstack gap-2 fs-7 fw-bold text-dark"><img
                                                src="../images/svgs/secondary-leaf.svg" alt="" width="20" height="20"
                                                class="img-fluid animate-spin">í™ˆ</a>
                                    </li>
                                    <li class="header-item" id="patientMenuItem">
                                        <a href="/patient/dashboard.html" class="header-link hstack gap-2 fs-7 fw-bold text-dark" id="patientMenuLink"><img
                                                src="../images/svgs/secondary-leaf.svg" alt="" width="20" height="20"
                                                class="img-fluid animate-spin">í™˜ì ëŒ€ì‹œë³´ë“œ</a>
                                    </li>
                                    <li class="header-item" id="managerMenuItem">
                                        <a href="../manager/dashboard.html" class="header-link hstack gap-2 fs-7 fw-bold text-dark" id="managerMenuLink"><img
                                                src="../images/svgs/secondary-leaf.svg" alt="" width="20" height="20"
                                                class="img-fluid animate-spin">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</a>
                                    </li>
                                    <li class="header-item" id="myPageMenuItem">
                                        <a href="../user/mypage.html" class="header-link hstack gap-2 fs-7 fw-bold text-dark" id="myPageMenuLinkAnchor"><img
                                                src="../images/svgs/secondary-leaf.svg" alt="" width="20" height="20"
                                                class="img-fluid animate-spin">ë§ˆì´ í˜ì´ì§€</a>
                                    </li>
                                </ul>
                                <div class="hstack gap-3" id="auth-btn-group">
                                    <a href="sign-in.html"
                                       class="btn btn-outline-light fs-6 bg-white px-3 py-2 text-dark w-50 hstack justify-content-center">ë¡œê·¸ì¸</a>
                                    <a href="sign-up.html"
                                       class="btn btn-dark text-white fs-6 bg-dark px-3 py-2 w-50 hstack justify-content-center">íšŒì›ê°€ì…</a>
                                </div>
                            </div>
                        </div>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="container my-5 pt-5">

    <div class="row mb-4 justify-content-center">
        <div class="col-12 col-md-10 fade-in-up">

            <div class="d-flex justify-content-center align-items-start gap-4 flex-wrap flex-lg-nowrap main-flex-area">

                <div class="p-3 p-md-5 bg-white rounded shadow camera-control-card">

                    <div class="d-flex align-items-center mb-3 control-header justify-content-between">
                        <div class="d-flex align-items-center detection-toggle-area-inner">
                            <div class="checkbox-wrapper-5">
                                <div class="check">
                                    <input id="detectionToggle" type="checkbox">
                                    <label for="detectionToggle"></label>
                                </div>
                            </div>
                            <span id="detectionStatus" class="ms-3 fw-bold text-stopped">ë™ì‘ ì¸ì‹ ì •ì§€ ì¤‘</span>
                        </div>

                        <button class="Documents-btn" data-bs-toggle="modal"          data-bs-target="#motionDictionaryModal" onclick="loadUserMotions(false)">
                            <span class="folderContainer">
                                <svg
                                        class="fileBack"
                                        width="146"
                                        height="113"
                                        viewBox="0 0 146 113"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                            d="M0 4C0 1.79086 1.79086 0 4 0H50.3802C51.8285 0 53.2056 0.627965 54.1553 1.72142L64.3303 13.4371C65.2799 14.5306 66.657 15.1585 68.1053 15.1585H141.509C143.718 15.1585 145.509 16.9494 145.509 19.1585V109C145.509 111.209 143.718 113 141.509 113H3.99999C1.79085 113 0 111.209 0 109V4Z"
                                            fill="url(#paint0_linear_117_4)"
                                    ></path>
                                    <defs>
                                        <linearGradient
                                                id="paint0_linear_117_4"
                                                x1="0"
                                                y1="0"
                                                x2="72.93"
                                                y2="95.4804"
                                                gradientUnits="userSpaceOnUse"
                                        >
                                            <stop stop-color="#8F88C2"></stop>
                                            <stop offset="1" stop-color="#5C52A2"></stop>
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <svg
                                        class="filePage"
                                        width="88"
                                        height="99"
                                        viewBox="0 0 88 99"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                >
                                    <rect width="88" height="99" fill="url(#paint0_linear_117_6)"></rect>
                                    <defs>
                                        <linearGradient
                                                id="paint0_linear_117_6"
                                                x1="0"
                                                y1="0"
                                                x2="81"
                                                y2="160.5"
                                                gradientUnits="userSpaceOnUse"
                                        >
                                            <stop stop-color="white"></stop>
                                            <stop offset="1" stop-color="#686868"></stop>
                                        </linearGradient>
                                    </defs>
                                </svg>

                                <svg
                                        class="fileFront"
                                        width="160"
                                        height="79"
                                        viewBox="0 0 160 79"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                            d="M0.29306 12.2478C0.133905 9.38186 2.41499 6.97059 5.28537 6.97059H30.419H58.1902C59.5751 6.97059 60.9288 6.55982 62.0802 5.79025L68.977 1.18034C70.1283 0.410771 71.482 0 72.8669 0H77H155.462C157.87 0 159.733 2.1129 159.43 4.50232L150.443 75.5023C150.19 77.5013 148.489 79 146.474 79H7.78403C5.66106 79 3.9079 77.3415 3.79019 75.2218L0.29306 12.2478Z"
                                            fill="url(#paint0_linear_117_5)"
                                    ></path>
                                    <defs>
                                        <linearGradient
                                                id="paint0_linear_117_5"
                                                x1="38.7619"
                                                y1="8.71323"
                                                x2="66.9106"
                                                y2="82.8317"
                                                gradientUnits="userSpaceOnUse"
                                        >
                                            <stop stop-color="#C3BBFF"></stop>
                                            <stop offset="1" stop-color="#51469A"></stop>
                                        </linearGradient>
                                    </defs>
                                </svg>
                            </span>
                            <p class="text">ë‚˜ì˜ ë™ì‘ ì‚¬ì „</p>
                        </button>
                    </div>

                    <!-- âœ… ì—¬ê¸°ë¶€í„° ìƒˆë¡œ ì¶”ê°€ë˜ëŠ” íŒíŠ¸ ì¹´ë“œ (dashboardì˜ tutorial-bar ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš©) -->
                    <div class="tutorial-bar info-hint mt-2" style="margin-bottom: 0.5rem">
                        <div class="tutorial-content">
                            <iconify-icon icon="mdi:lightbulb" class="tutorial-icon"></iconify-icon>
                            <div class="tutorial-text">
                                <h6 class="mb-0">ìë™ ë™ì‘ ì‚¬ì „ ë¶ˆëŸ¬ì˜¤ê¸°</h6>
                                <p class="mb-0">
                                    ìš°ë¦¬ëŠ” ì‚¬ìš©ì í¸ì˜ë¥¼ ìœ„í•´ <b>ëˆˆ, ì–¼êµ´, ì†(ê¸°ë³¸Â·ìˆ˜ì–´)</b> ë™ì‘ ì‚¬ì „ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.<br><b>ì‹¤ì‹œê°„ ë™ì‘ ì¸ì‹ í˜ì´ì§€</b>ì˜
                                    <span class="text-primary fw-semibold">ë‚˜ì˜ ë™ì‘ì‚¬ì „</span>ì—ì„œ ë¶ˆëŸ¬ì˜¬ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div id="container" class="mx-auto">
                        <video id="webcam" autoplay playsinline></video>
                        <canvas id="output_canvas"></canvas>
                    </div>

                    <div id="status" class="mt-3">ìƒíƒœ: ì¹´ë©”ë¼ ì—°ê²° ëŒ€ê¸° ì¤‘</div>
                </div>

                <div class="d-flex flex-column gap-4 right-side-column">

                    <div class="p-4 rounded shadow range-select-card">
                        <h5 class="mb-3 text-center text-dark fw-bold">ì¸ì‹ ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h5>
                        <div class="detect-btns-select" id="detectAreaBtns">
                            <button class="detect-btn active" data-value="hands" id="detectHandsBtn">ì†</button>
                            <button class="detect-btn" data-value="face" id="detectFaceBtn">ì–¼êµ´</button>
                            <button class="detect-btn" data-value="eyes" id="detectEyesBtn">ëˆˆ</button>
                        </div>
                    </div>

<!--                    <div class="p-4 bg-primary rounded shadow text-white detected-phrase-card">-->
<!--                        <h5 class="mb-2 text-center text-white-75">ì¸ì‹ëœ ë¬¸ì¥</h5>-->
<!--                        <div id="detectedPhrase" class="text-center">ì¸ì‹ ëŒ€ê¸° ì¤‘</div>-->

<!--                        &lt;!&ndash; âœ… LangGraph ë¬¸ì¥ ìƒì„± ë²„íŠ¼ &ndash;&gt;-->
<!--                        <button-->
<!--                                id="generateSentenceBtn"-->
<!--                                class="btn btn-light mt-3 w-100 fw-semibold"-->
<!--                                onclick="generateSentenceForCurrentUser()">-->
<!--                            âœ¨ ìµœê·¼ ë™ì‘ìœ¼ë¡œ ë¬¸ì¥ ìƒì„±í•˜ê¸°-->
<!--                        </button>-->

<!--                        <small class="d-block mt-1 text-center text-white-75">-->
<!--                            ìµœê·¼ ì¸ì‹ëœ ë‹¨ì–´ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ AAC ë¬¸ì¥ì„ ìƒì„±í•©ë‹ˆë‹¤.-->
<!--                        </small>-->
<!--                    </div>-->
                    <div class="p-4 bg-primary rounded shadow text-white detected-phrase-card">
                        <!-- âœ… ì‹¤ì‹œê°„ ì¸ì‹ëœ ì˜ë¯¸ -->
                        <h5 class="mb-2 text-center text-white-75">ì¸ì‹ëœ ì˜ë¯¸</h5>
                        <div id="detectedPhrase" class="text-center">ì¸ì‹ ëŒ€ê¸° ì¤‘</div>

                        <hr class="my-3 opacity-50">

                        <!-- âœ… LangGraph ìƒì„±ëœ ë¬¸ì¥ -->
                        <h6 class="mb-1 text-center text-white-75" style="color:white">ìƒì„±ëœ ë¬¸ì¥</h6>
                        <div id="generatedSentence" class="text-center generated-sentence">
                            ì•„ì§ ìƒì„±ëœ ë¬¸ì¥ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>

                        <!-- âœ… LangGraph ë¬¸ì¥ ìƒì„± ë²„íŠ¼ -->
                        <button
                                id="generateSentenceBtn"
                                class="btn btn-light mt-3 w-100 fw-semibold"
                                style="visibility: hidden;"
                                onclick="generateSentenceForCurrentUser()">
                            âœ¨ ìµœê·¼ ë™ì‘ìœ¼ë¡œ ë¬¸ì¥ ìƒì„±í•˜ê¸°
                        </button>

                        <small class="d-block mt-1 text-center text-white-75">
                            ìµœê·¼ 10ì´ˆë™ì•ˆ ì¸ì‹ëœ ë‹¨ì–´ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ AAC ë¬¸ì¥ì„ ìƒì„±í•©ë‹ˆë‹¤.
                        </small>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="motionDictionaryModal" tabindex="-1" aria-labelledby="motionDictionaryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header d-flex justify-content-between align-items-center">
                    <h5 class="modal-title" id="motionDictionaryModalLabel">ë‚˜ì˜ ë™ì‘ ì‚¬ì „</h5>
                    <div class="d-flex align-items-center">
                        <div class="d-flex flex-column align-items-center me-3">
                            <button type="button" class="btn btn-primary btn-sm mb-1" id="loadDictionaryBtn">ë™ì‘ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                            <small class="text-muted text-center" style="font-size: 0.70rem; line-height: 1;">ì‚¬ì „ì— ë“±ë¡ëœ ê¸°ë³¸ ë™ì‘ì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</small>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body" id="motionDictionaryModalBody">

                    <div class="user-controls">
                        <div class="user-input">
                            <label for="userIdInputModal" class="visually-hidden">ì‚¬ìš©ì ID (í‘œì‹œìš©):</label>
                            <input type="text" id="userIdInputModal" class="visually-hidden" value="" placeholder="ì‚¬ìš©ì ID" readonly>

                            <button class="btn btn-primary" onclick="loadUserMotions(true)">ğŸ”„ ë™ì‘ ìƒˆë¡œê³ ì¹¨</button>
                        </div>
                        <button class="btn btn-danger" onclick="deleteAllMotions()" id="deleteBtnModal" disabled>
                            ğŸ—‘ï¸ ëª¨ë“  ë™ì‘ ì‚­ì œ
                        </button>
                    </div>

                    <div id="messageContainerModal"></div>

<!--                    <div id="statsContainerModal" style="display: none;">-->
<!--                        <div class="stats">-->
<!--                            <div class="stat-item">-->
<!--                                <div class="stat-number" id="totalCountModal">0</div>-->
<!--                                <div class="stat-label">ì´ ë™ì‘ ê°œìˆ˜</div>-->
<!--                            </div>-->
<!--                            <div class="stat-item">-->
<!--                                <div class="stat-number" id="typeCountModal">0</div>-->
<!--                                <div class="stat-label">ë™ì‘ ì¢…ë¥˜ ìˆ˜</div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->

                    <div id="loadingContainerModal" class="loading" style="display: none;">
                        <p>ğŸ”„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>

                    <div class="tab-container" id="motionTabContainerModal" style="display: none;">
                        <div class="tab-buttons">
                            <button class="tab-button active" data-type="hands" onclick="openTabModal(event, 'HandsModal')">ğŸ‘‹ ì†</button>
                            <button class="tab-button" data-type="eyes" onclick="openTabModal(event, 'EyesModal')">ğŸ‘€ ëˆˆ</button>
                            <button class="tab-button" data-type="face" onclick="openTabModal(event, 'FaceModal')">ğŸ˜Š ì–¼êµ´</button>
                        </div>

                        <div class="tab-content">
                            <div id="HandsModal" class="tab-pane active"></div>
                            <div id="EyesModal" class="tab-pane"></div>
                            <div id="FaceModal" class="tab-pane"></div>
                        </div>
                    </div>

                    <div id="motionContainerModal" class="motion-container">
                        <div class="empty-state">
                            <h3>ì‚¬ìš©ìì˜ ëª¨ì…˜ì„ ì¡°íšŒí•©ë‹ˆë‹¤.</h3>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>
</div>




<footer class="footer bg-dark py-5 py-lg-11 py-xl-5">
    <div class="container">
        <div class="row">
            <div class="col-xl-5 mb-8 mb-xl-0">
                <div class="d-flex flex-column gap-8 pe-xl-5">
                    <h4 class="mb-0 text-white">ì´ í”„ë¡œì íŠ¸ëŠ” <br> 2025 ìƒˆì‹¹ í•´ì»¤í†¤
                        <br>ê³µëª¨ì „ ì¶œí’ˆì‘ì…ë‹ˆë‹¤</h4>
                </div>
            </div>
            <div class="col-md-6 col-xl-4 mb-8 mb-xl-0">
                <div class="d-flex flex-column gap-2">
                    <a href="https://dacon.io/competitions/official/236624/overview/description" target="_blank" class="link-hover hstack gap-3 text-white fs-5">
                        <iconify-icon icon="lucide:arrow-up-right" class="fs-7 text-primary"></iconify-icon>
                        https://dacon.io
                    </a>
                    <a href="https://buly.kr/Awg81rV" target="_blank"
                       class="link-hover hstack gap-3 text-white fs-5">
                        <iconify-icon icon="lucide:map-pin" class="fs-7 text-primary"></iconify-icon>
                        200ok
                    </a>
                </div>
            </div>
            <div class="col-md-4 col-xl-3 mb-8 mb-xl-0">
                <p class="mb-0 text-white text-opacity-70 text-md-end">Â© CueCode copyright 2025</p>
            </div>
        </div>
    </div>
    <p class="mb-0 text-white text-opacity-70 text-md-center mt-10">Distributed by <a class="text-white"  target="_blank">Team Ujangsan Spirit</a></p>
</footer>
<div class="get-template hstack gap-2">
    <button class="btn bg-primary p-2 round-52 rounded-circle hstack justify-content-center flex-shrink-0"
            id="scrollToTopBtn">
        <iconify-icon icon="lucide:arrow-up" class="fs-7 text-dark"></iconify-icon>
    </button>
</div>

<script src="../js/user/index.js"></script>
<script src="../js/config.js"></script>
<script src="../libs/jquery/dist/jquery.min.js"></script>
<script src="../libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="../libs/owl.carousel/dist/owl.carousel.min.js"></script>
<script src="../libs/aos-master/dist/aos.js"></script>

<script type="module" src="/vendor/mediapipe/js/vision_bundle.js"></script>

<script type="module">
    // MotionLink Demo v0.6ì˜ JavaScript ì½”ë“œ + CueCode í† ê¸€ ìŠ¤ìœ„ì¹˜ ì—°ë™ ë¡œì§

    // Pick the correct backend port!
    // const WEBSOCKET_URL = "ws://localhost:8000/ws/motion";
    const WEBSOCKET_URL = `${window.WEBSOCKET_BASE_URL}/ws/motion`;

    const SEND_INTERVAL_MS = 100;
    const SEGMENT_MS = 1000; // send "end" every 1s while streaming
    let lastSegmentTs = 0;

    const video = document.getElementById("webcam");
    const canvasElement = document.getElementById("output_canvas");
    const canvasCtx = canvasElement.getContext("2d");

    // MotionLink ë‚´ë¶€ ìƒíƒœ ë©”ì‹œì§€ (Detailed)
    const statusDiv = document.getElementById("status");
    // CueCode UI ìƒë‹¨ ë™ì‘ ì¸ì‹ ìƒíƒœ í…ìŠ¤íŠ¸ (UI/Styling)
    const detectionStatusSpan = document.getElementById("detectionStatus");
    // CueCode í† ê¸€ ìŠ¤ìœ„ì¹˜ ìš”ì†Œ
    const toggle = document.getElementById('detectionToggle');

    const phraseDiv = document.getElementById("detectedPhrase");
    const generatedSentenceDiv = document.getElementById("generatedSentence");

    const { FaceLandmarker, HandLandmarker, FilesetResolver, DrawingUtils } =
        await import("/vendor/mediapipe/js/vision_bundle.js");

    let faceLandmarker, handLandmarker, drawingUtils, socket;
    let detectionActive = false;
    let lastVideoTime = -1, lastSendTime = 0;
    let selectedDetectionArea = 'hands'; // 'hands' | 'face' | 'eyes'

    function getNormalizedDetectionArea(raw) {
        if (!raw) return 'hand';
        if (raw === 'hands') return 'hand';
        return 'face'; // treat face/eyes the same for backend
    }

    function sendEnd(area = getNormalizedDetectionArea(selectedDetectionArea)) {
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({ type: "end", detectionArea: area }));
        }
    }

    /**
     * UI ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. (í† ê¸€, ìƒë‹¨ í…ìŠ¤íŠ¸, ìƒ‰ìƒ)
     * @param {boolean} isRunning - ì¸ì‹ì´ ì‹¤í–‰ ì¤‘ì¸ì§€ ì—¬ë¶€
     */
    function setUIStatus(isRunning) {
        toggle.checked = isRunning;
        if (isRunning) {
            detectionStatusSpan.textContent = "ë™ì‘ ì¸ì‹ ì¤‘";
            detectionStatusSpan.classList.remove('text-stopped');
            detectionStatusSpan.classList.add('text-running');
        } else {
            detectionStatusSpan.textContent = "ë™ì‘ ì¸ì‹ ì •ì§€ ì¤‘";
            detectionStatusSpan.classList.remove('text-running');
            detectionStatusSpan.classList.add('text-stopped');
        }
    }

    function setupDetectAreaButtons() {
        const container = document.getElementById('detectAreaBtns');
        if (!container) return;
        container.querySelectorAll('.detect-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const prevArea = getNormalizedDetectionArea(selectedDetectionArea);
                container.querySelectorAll('.detect-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedDetectionArea = btn.dataset.value || 'hands';
                const nextArea = getNormalizedDetectionArea(selectedDetectionArea);
                // When switching modes, close the current segment explicitly
                if (detectionActive && prevArea !== nextArea) {
                    sendEnd(prevArea);
                    lastSegmentTs = performance.now();
                }
            });
        });
    }

    async function createLandmarkers() {
        const vision = await FilesetResolver.forVisionTasks("/vendor/mediapipe/wasm");
        drawingUtils = new DrawingUtils(canvasCtx);
        faceLandmarker = await FaceLandmarker.createFromOptions(vision, {
            baseOptions: { modelAssetPath: `/vendor/mediapipe/models/face_landmarker.task`, delegate: "GPU" },
            outputFaceBlendshapes: true,
            runningMode: "VIDEO",
            numFaces: 1
        });
        handLandmarker = await HandLandmarker.createFromOptions(vision, {
            baseOptions: { modelAssetPath: `/vendor/mediapipe/models/hand_landmarker.task`, delegate: "GPU" },
            runningMode: "VIDEO",
            numHands: 2
        });
        statusDiv.textContent = "ìƒíƒœ: ì›¹ìº  ë¡œë”© ì¤‘...";
    }

    function enableCam() {
        navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {
            video.srcObject = stream;
            video.addEventListener("loadeddata", predictWebcam);
            statusDiv.textContent = "ìƒíƒœ: ì›¹ìº  í™œì„±í™”ë¨";
        }).catch((err) => {
            statusDiv.textContent = "ì˜¤ë¥˜: ì›¹ìº  ì ‘ê·¼ ì‹¤íŒ¨";
            console.error(err);
        });
    }

    async function predictWebcam() {
        // Keep canvas in sync with video
        if (canvasElement.width !== video.videoWidth || canvasElement.height !== video.videoHeight) {
            canvasElement.width = video.videoWidth || 640;
            canvasElement.height = video.videoHeight || 480;
        }

        const nowPerf = performance.now();

        if (lastVideoTime !== video.currentTime && detectionActive) {
            lastVideoTime = video.currentTime;

            // Run detectors
            const faceResults = faceLandmarker.detectForVideo(video, nowPerf);
            const handResults = handLandmarker.detectForVideo(video, nowPerf);

            // Draw results
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

            if (handResults.landmarks) {
                for (const landmarks of handResults.landmarks) {
                    drawingUtils.drawConnectors(landmarks, HandLandmarker.HAND_CONNECTIONS, { color: "#FFFFFF", lineWidth: 2 });
                    drawingUtils.drawLandmarks(landmarks, { color: "#FF0000", lineWidth: 1 });
                }
            }
            if (faceResults.faceLandmarks) {
                for (const landmarks of faceResults.faceLandmarks) {
                    drawingUtils.drawConnectors(landmarks, FaceLandmarker.FACE_LANDMARKS_TESSELATION, { color: "#C0C0C070", lineWidth: 1 });
                }
            }
            canvasCtx.restore();

            // Throttle frame sending
            if (nowPerf - lastSendTime > SEND_INTERVAL_MS) {
                lastSendTime = nowPerf;
                processAndSend(faceResults, handResults);
            }

            // Periodic segment boundary
            if (nowPerf - lastSegmentTs > SEGMENT_MS) {
                sendEnd();
                lastSegmentTs = nowPerf;
            }
        }

        window.requestAnimationFrame(predictWebcam);
    }

    function processAndSend(faceResults, handResults) {
        const faceBlendshapes = faceResults.faceBlendshapes.length > 0
            ? Object.fromEntries(faceResults.faceBlendshapes[0].categories.map(c => [c.categoryName, c.score]))
            : {};

        const getHandData = (handednesses, landmarks, handName) => {
            if (!handednesses || !landmarks) return null;
            const idx = handednesses.findIndex(h => (h[0] && h[0].categoryName) === handName);
            return idx > -1 ? landmarks[idx].map(p => [p.x, p.y, p.z]) : null;
        };

        const frame = {
            timestamp_ms: Date.now(),
            face_blendshapes: faceBlendshapes,
            left_hand_landmarks: getHandData(handResults.handednesses, handResults.landmarks, "Left"),
            right_hand_landmarks: getHandData(handResults.handednesses, handResults.landmarks, "Right")
        };

        if (!socket || socket.readyState !== WebSocket.OPEN) return;

        const normalizedArea = getNormalizedDetectionArea(selectedDetectionArea);
        let features = null;

        if (normalizedArea === 'face') {
            if (Object.keys(faceBlendshapes).length === 0) return;
            const featureKeys = Object.keys(faceBlendshapes).sort();
            features = featureKeys.map(k => Number(faceBlendshapes[k] || 0));

            socket.send(JSON.stringify({
                type: "frame",
                detectionArea: normalizedArea,
                timestamp_ms: frame.timestamp_ms,
                featureKeys: featureKeys,
                features: features
            }));
        } else { // hand
            const right = frame.right_hand_landmarks || null;
            const left = frame.left_hand_landmarks || null;
            if ((!Array.isArray(right) || right.length === 0) && (!Array.isArray(left) || left.length === 0)) {
                return;
            }
            const pointCount = Math.max((right && right.length) || 0, (left && left.length) || 0);
            const vec = [];
            for (let i = 0; i < pointCount; i++) {
                if (right && right[i] && right[i].length >= 3) { vec.push(+right[i][0]||0, +right[i][1]||0, +right[i][2]||0); }
                else { vec.push(0,0,0); }
            }
            for (let i = 0; i < pointCount; i++) {
                if (left && left[i] && left[i].length >= 3) { vec.push(+left[i][0]||0, +left[i][1]||0, +left[i][2]||0); }
                else { vec.push(0,0,0); }
            }
            features = vec;

            socket.send(JSON.stringify({
                type: "frame",
                detectionArea: normalizedArea,
                timestamp_ms: frame.timestamp_ms,
                features: features
            }));
        }
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            window.speechSynthesis.speak(utterance);
        }
    }

    function initWebSocket() {
        const token = getCookie('jwtAccessToken');
        const url = token ? `${WEBSOCKET_URL}?token=${encodeURIComponent(token)}` : WEBSOCKET_URL;

        socket = new WebSocket(url);
        socket.onopen = () => {
            detectionActive = true;
            lastSegmentTs = performance.now();

            // -&#45;&#45; UI Bridge: Start ìƒíƒœ ì—…ë°ì´íŠ¸ -&#45;&#45;-->
            phraseDiv.textContent = "-";
            statusDiv.textContent = "ìƒíƒœ: ì„œë²„ ì—°ê²°ë¨ (ì¸ì‹ ì¤‘)";
            setUIStatus(true); // í† ê¸€ê³¼ ìƒë‹¨ í…ìŠ¤íŠ¸ë¥¼ "ì¸ì‹ ì¤‘"ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            // &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
        };
        socket.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                if (data.type === "match") {
                    const phrase = data.matched && data.phrase ? data.phrase : "ì¸ì‹ëœ ì˜ë¯¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
                    phraseDiv.textContent = phrase;
                    if (data.matched && data.phrase) speak(data.phrase);
                }
            } catch {
                phraseDiv.textContent = "ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜";
            }
        };
        socket.onerror = () => {
            // Try to close the current segment before closing the socket
            sendEnd();
            if (socket && socket.readyState === WebSocket.OPEN) socket.close();
            phraseDiv.textContent = "WebSocket ì˜¤ë¥˜";
        };
        socket.onclose = () => {
            detectionActive = false;

            // -&#45;&#45; UI Bridge: Stop ìƒíƒœ ì—…ë°ì´íŠ¸ -&#45;&#45;-->
            statusDiv.textContent = "ìƒíƒœ: ì—°ê²° ì¢…ë£Œë¨";
            setUIStatus(false); // í† ê¸€ê³¼ ìƒë‹¨ í…ìŠ¤íŠ¸ë¥¼ "ì •ì§€ ì¤‘"ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            stopAutoSentenceLoop();
            // &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
        };
    }


    // -&#45;&#45; í† ê¸€ ìŠ¤ìœ„ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: UI ë° ê¸°ëŠ¥ ì—°ë™ -&#45;&#45;-->
    if (toggle) {
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìƒíƒœ ì„¤ì • (unchecked = ì •ì§€ ì¤‘)
        setUIStatus(toggle.checked);

        toggle.addEventListener('change', async (event) => {
            const isChecked = event.target.checked;

            // 1. UI ìƒíƒœë¥¼ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            setUIStatus(isChecked);

            if (isChecked) {

                await reloadMotionCacheForCurrentUser();
                // í† ê¸€ ì¼œì§: ë™ì‘ ì¸ì‹ ì‹œì‘
                if (!socket || socket.readyState === WebSocket.CLOSED) {
                    initWebSocket();
                }

                startAutoSentenceLoop();

            } else {
                // í† ê¸€ êº¼ì§: ë™ì‘ ì¸ì‹ ì¢…ë£Œ
                if (socket && socket.readyState === WebSocket.OPEN) {
                    detectionActive = false;
                    sendEnd();
                    socket.close();
                }

                stopAutoSentenceLoop();
            }
        });
    }
    // ----------------------------------------


    // Also close segment on page hide/unload
    window.addEventListener('visibilitychange', () => {
        if (document.hidden) sendEnd();
    });
    window.addEventListener('beforeunload', () => {
        sendEnd();
    });

    const loadDictionaryBtn = document.getElementById('loadDictionaryBtn');
    if (loadDictionaryBtn) {
        loadDictionaryBtn.addEventListener('click', () => {
            // Check if WebSocket is connected
            if (!socket || socket.readyState !== WebSocket.OPEN) {
                Swal.fire({
                    icon: 'warning',
                    title: 'ë™ì‘ ì¸ì‹ì„ ë¨¼ì € ì¼œì£¼ì„¸ìš”',
                    text: 'ì›¹ì†Œì¼“ì´ ì—°ê²°ë˜ì–´ ìˆì–´ì•¼ ì‚¬ì „ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                });
                return;
            }

            // Send a message to the backend to load dictionaries
            // IMPORTANT: Backend must be updated to handle this message!
            socket.send(JSON.stringify({ type: 'load_dictionaries' }));

            Swal.fire({
                icon: 'success',
                title: 'ìš”ì²­ ì „ì†¡ ì™„ë£Œ',
                text: 'ì„œë²„ì— ë™ì‘ ì‚¬ì „ ë¡œë“œë¥¼ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.',
                timer: 1500,
                showConfirmButton: false,
            });

            // Close the modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('motionDictionaryModal'));
            if (modal) {
                modal.hide();
            }
        });
    }

    // === initialize ===
    await createLandmarkers();
    enableCam();
    setupDetectAreaButtons();
</script>
<script src="../js/custom.js"></script>




<script>
    // --------------------------------------------------------------------------------
    // 1. ì¸ì¦ ë° API ìœ í‹¸ë¦¬í‹° (ëª¨ë‹¬ìš© Service í´ë˜ìŠ¤)
    // --------------------------------------------------------------------------------

    // API Gateway URL: ì‹¤ì œ ë°°í¬ í™˜ê²½ì— ë§ê²Œ config.jsì˜ API_BASE ë“±ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
    const API_GATEWAY_URL_MODAL = window.API_BASE;

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
    }

    function getAccessToken() {
        try {
            const cookieToken = getCookie('jwtAccessToken');
            if (cookieToken) return cookieToken;
        } catch (e) { /* ignore */ }
        try {
            const ls = localStorage.getItem('jwtAccessToken');
            if (ls) return ls;
        } catch (e) { /* ignore */ }
        try {
            const ss = sessionStorage.getItem('jwtAccessToken');
            if (ss) return ss;
        } catch (e) { /* ignore */ }
        return null;
    }

    function getAuthenticatedUserId() {
        const token = getAccessToken();
        if (!token) return null;
        try {
            if (typeof jwt_decode === 'undefined') {
                console.error("jwt-decode ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return null;
            }
            const decoded = jwt_decode(token);
            return decoded && (decoded.sub || decoded.userId || decoded.preferred_username || decoded.username || decoded.name || decoded.uid) || null;
        } catch (e) {
            console.debug('[Auth] Failed to decode token for userId extraction', e);
            return null;
        }
    }

    const API_ENDPOINTS_MODAL = {
        RECORDED_MOTIONS_BASE: '/v1/recorded-motions',
    };

    class RecordedMotionServiceModal {
        constructor() {
            this.apiBase = API_GATEWAY_URL_MODAL;
            this.currentUserId = null;
        }

        getAuthHeaders() {
            const token = getAccessToken();
            const headers = { 'Content-Type': 'application/json' };
            if (token) { headers['Authorization'] = 'Bearer ' + token; }
            return headers;
        }

        async getRecordedMotions() {
            const url = `${this.apiBase}${API_ENDPOINTS_MODAL.RECORDED_MOTIONS_BASE}`;
            const resp = await fetch(url, {
                method: 'GET',
                headers: this.getAuthHeaders(),
                credentials: 'include'
            });

            if (!resp.ok) {
                const text = await resp.text().catch(() => '');
                const err = new Error(`${resp.status} ${resp.statusText}: ${text}`);
                err.status = resp.status;
                throw err;
            }
            return await resp.json();
        }
    }

    const motionServiceModal = new RecordedMotionServiceModal();


    // --------------------------------------------------------------------------------
    // 2. ëª¨ë‹¬ UI ì œì–´ ë° ë°ì´í„° ë¡œë”©/ë Œë”ë§ ë¡œì§ (ID: *Modal)
    // --------------------------------------------------------------------------------

    // ëª¨ë‹¬ ë‚´ë¶€ì˜ DOM IDì— 'Modal' ì ‘ë¯¸ì‚¬ê°€ ë¶™ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  ì‘ì„±
    function showMessageModal(message, type = 'info') {
        const container = document.getElementById('messageContainerModal');
        const className = type === 'error' ? 'error-message' : 'success-message';
        if (container) container.innerHTML = `<div class="${className}">${message}</div>`;
        setTimeout(() => { if (container) container.innerHTML = ''; }, 5000);
    }

    function showLoadingModal(show) { const el = document.getElementById('loadingContainerModal'); if (el) el.style.display = show ? 'block' : 'none'; }
    function showTabContainerModal(show) { const el = document.getElementById('motionTabContainerModal'); if (el) el.style.display = show ? 'block' : 'none'; }

    function updateStatsModal(motions) {
        const statsContainer = document.getElementById('statsContainerModal');
        const totalCount = document.getElementById('totalCountModal');
        const typeCount = document.getElementById('typeCountModal');
        if (!statsContainer || !totalCount || !typeCount) return;

        if (motions && motions.length > 0) {
            const motionTypes = new Set(motions.map(m => m.motionType));
            totalCount.textContent = motions.length;
            typeCount.textContent = motionTypes.size;
            statsContainer.style.display = 'flex'; // flexë¡œ ë³€ê²½ (CSSì—ì„œ ì •ì˜ë˜ì—ˆì„ ê²½ìš°)
        } else {
            statsContainer.style.display = 'none';
        }
    }

    function openTabModal(evt, tabName) {
        const tabpanes = document.getElementsByClassName("tab-pane");
        // ëª¨ë‹¬ ë‚´ì˜ íƒ­ íŒ¨ë„ë§Œ ì°¾ê¸° ìœ„í•´ ID í™•ì¸
        for (let i = 0; i < tabpanes.length; i++) {
            if(tabpanes[i].id.endsWith('Modal')) tabpanes[i].classList.remove('active');
        }

        const tablinks = document.querySelectorAll("#motionTabContainerModal .tab-button");
        tablinks.forEach(link => link.classList.remove('active'));

        document.getElementById(tabName).classList.add('active');
        if (evt && evt.currentTarget) {
            evt.currentTarget.classList.add('active');
        }
    }

    function renderMotionListModal(motions) {
        const mainContainer = document.getElementById('motionContainerModal');
        const deleteBtn = document.getElementById('deleteBtnModal');
        const motionTypes = ['hands', 'eyes', 'face'];

        if (!mainContainer) return;

        if (!motions || motions.length === 0) {
            mainContainer.innerHTML = `<div class="empty-state"><h3>ğŸ“­ ë…¹í™”ëœ ëª¨ì…˜ì´ ì—†ìŠµë‹ˆë‹¤</h3><p>í˜„ì¬ ì‚¬ìš©ìì—ê²Œ ë“±ë¡ëœ ìˆ˜ì–´ ëª¨ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
            if (deleteBtn) deleteBtn.disabled = true;
            showTabContainerModal(false);
            return;
        }

        if (deleteBtn) deleteBtn.disabled = true; // ì‚­ì œ ë¡œì§ ì œì™¸ ì‹œ í•­ìƒ ë¹„í™œì„±í™”
        showTabContainerModal(true);
        mainContainer.innerHTML = '';

        const motionsByType = motions.reduce((acc, motion) => {
            const type = motion.motionType.toLowerCase();
            if (motionTypes.includes(type)) {
                if (!acc[type]) acc[type] = [];
                acc[type].push(motion);
            }
            return acc;
        }, {});

        const motionTypeEmojis = { 'hands': 'ğŸ‘‹','face': 'ğŸ˜Š','eyes': 'ğŸ‘€' };
        const typeLabels = { 'hands': 'ì†', 'eyes': 'ëˆˆ', 'face': 'ì–¼êµ´' };

        const tabButtons = document.querySelectorAll('#motionTabContainerModal .tab-buttons .tab-button');
        tabButtons.forEach(button => {
            const typeKey = button.dataset.type || 'hands';
            const count = (motionsByType[typeKey] || []).length;
            const displayLabel = typeLabels[typeKey] || typeKey;
            button.innerHTML = `${motionTypeEmojis[typeKey] || ''} ${displayLabel} (${count}ê°œ)`;
        });

        motionTypes.forEach(type => {
            const paneId = type.charAt(0).toUpperCase() + type.slice(1) + 'Modal';
            const paneEl = document.getElementById(paneId);
            const typeMotions = motionsByType[type] || [];

            if (paneEl) {
                if (typeMotions.length === 0) {
                    paneEl.innerHTML = `<div class="empty-state" style="padding: 20px;">
                                            <p>${motionTypeEmojis[type]} ${typeLabels[type]} ëª¨ì…˜ì€ í˜„ì¬ ë“±ë¡ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                        </div>`;
                } else {
                    paneEl.innerHTML = typeMotions.map(motion => `
                        <div class="motion-item">
                            <div class="motion-details">
                                <div class="phrase">ğŸ“ ${motion.phrase}</div>
                                <div class="description">ğŸ’¬ ${motion.description || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}</div>
                            </div>
                        </div>
                    `).join('');
                }
            }
        });

        // Hands íƒ­ì„ ê¸°ë³¸ìœ¼ë¡œ í™œì„±í™”
        const defaultTabButton = document.querySelector('#motionTabContainerModal .tab-button[data-type="hands"]');
        if (defaultTabButton) {
            openTabModal({ currentTarget: defaultTabButton }, 'HandsModal');
        }
    }

    /**
     * ë©”ì¸ ëª¨ë‹¬ ë°ì´í„° ë¡œë”© í•¨ìˆ˜
     * @param {boolean} isRefresh - ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ ëˆŒë €ëŠ”ì§€ ì—¬ë¶€
     */
    async function loadUserMotions(isRefresh = false) {
        const extractedUserId = getAuthenticatedUserId();
        const displayUser = extractedUserId || 'ì¸ì¦ëœ ì‚¬ìš©ì';
        const userIdInput = document.getElementById('userIdInputModal');
        if (userIdInput) userIdInput.value = displayUser;

        showLoadingModal(true);
        motionServiceModal.currentUserId = displayUser;

        try {
            const motions = await motionServiceModal.getRecordedMotions();
            renderMotionListModal(motions);
            updateStatsModal(motions);
            if (!isRefresh && motions && motions.length > 0) showMessageModal(`âœ… ${displayUser}ì˜ ëª¨ì…˜ ${motions.length}ê°œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
            else if (!isRefresh && motions && motions.length === 0) showMessageModal(`â„¹ï¸ ${displayUser}ì˜ ë…¹í™”ëœ ëª¨ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.`, 'info');
        } catch (error) {
            console.error('Error loading motions:', error);
            const status = error && error.status ? error.status : null;

            if (status === 401) {
                showMessageModal('âŒ 401 Unauthorized â€” ì¸ì¦ ì‹¤íŒ¨. ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'error');
            } else {
                showMessageModal(`âŒ ëª¨ì…˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message || error}`, 'error');
            }
            const container = document.getElementById('motionContainerModal'); if (container) container.innerHTML = '';
            showTabContainerModal(false);
            updateStatsModal([]);
        } finally { showLoadingModal(false); }
    }

    /**
     * ì‚­ì œ ë¡œì§ ëŒ€ì‹  ë¹„í™œì„±í™” ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
     */
    function deleteAllMotions() {
        showMessageModal("âŒ ì´ ëª¨ë‹¬ì—ì„œëŠ” ë°ì´í„° ì‚­ì œ ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.", 'error');
    }


    /**
     * í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ user_idë¥¼ ì´ìš©í•´
     * LangGraph ë¬¸ì¥ ìƒì„± APIë¥¼ í˜¸ì¶œí•˜ê³ ,
     * ê²°ê³¼ ë¬¸ì¥ì„ #detectedPhraseì— í‘œì‹œ + ìŒì„± ì¶œë ¥
     */
    // async function generateSentenceForCurrentUser() {
    //     const ALERT_MSG = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤(ë¬¸ì¥ ìƒì„±ì„ ìœ„í•´ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”)";
    //
    //     // âœ… index.jsì—ì„œ /user/me í˜¸ì¶œ ì‹œ ì„¸íŒ…í•œ ì „ì—­ userId ì‚¬ìš©
    //     const userId = window.userId;
    //
    //     if (!userId) {
    //         console.warn('[Sentence] ë¡œê·¸ì¸ ìœ ì € IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (window.userId ì—†ìŒ)');
    //         alert(ALERT_MSG);
    //         return;
    //     }
    //
    //     // Authorization í—¤ë”ëŠ” httpOnly ì¿ í‚¤ ê¸°ë°˜ì´ë©´ ì‚¬ì‹¤ ì—†ì–´ë„ ë¨
    //     const headers = { 'Content-Type': 'application/json' };
    //
    //     try {
    //         const res = await fetch(
    //             `${API_GATEWAY_URL_MODAL}/motions/users/${encodeURIComponent(userId)}/sentence`,
    //             {
    //                 method: 'POST',
    //                 headers,
    //                 credentials: 'include' // âœ… ì¿ í‚¤ ìë™ ì „ì†¡
    //             }
    //         );
    //
    //         if (res.status === 401 || res.status === 403) {
    //             console.log(res.status);
    //             alert(ALERT_MSG);
    //             return;
    //         }
    //
    //         if (!res.ok) {
    //             const text = await res.text().catch(() => '');
    //             console.error('generateSentence failed', res.status, text);
    //             alert('ë¬¸ì¥ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    //             return;
    //         }
    //
    //         const data = await res.json();
    //         if (data && data.sentence) {
    //             document.getElementById('detectedPhrase').textContent = data.sentence;
    //
    //             if (typeof speak === 'function') {
    //                 speak(data.sentence);
    //             }
    //
    //
    //         } else {
    //             console.warn('generateSentence: no sentence in response', data);
    //             alert('ë¬¸ì¥ ìƒì„± ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
    //         }
    //     } catch (err) {
    //         console.error('generateSentence error', err);
    //         alert('ë¬¸ì¥ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    //     }
    // }

    const generatedSentenceDiv = document.getElementById('generatedSentence');

    async function generateSentenceForCurrentUser() {
        const ALERT_MSG = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤(ë¬¸ì¥ ìƒì„±ì„ ìœ„í•´ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”)";

        // âœ… index.jsì—ì„œ /user/me í˜¸ì¶œ ì‹œ ì„¸íŒ…í•œ ì „ì—­ userId ì‚¬ìš©
        const userId = window.userId;

        if (!userId) {
            console.warn('[Sentence] ë¡œê·¸ì¸ ìœ ì € IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (window.userId ì—†ìŒ)');
            alert(ALERT_MSG);
            return;
        }

        const startTime = performance.now();
        console.log("[Sentence] Generation started at", startTime);


        // Authorization í—¤ë”ëŠ” httpOnly ì¿ í‚¤ ê¸°ë°˜ì´ë©´ ì‚¬ì‹¤ ì—†ì–´ë„ ë¨
        const headers = { 'Content-Type': 'application/json' };

        try {
            const res = await fetch(
                `${API_GATEWAY_URL_MODAL}/sentence/generate`,
                {
                    method: 'POST',
                    headers,
                    credentials: 'include',
                    body: JSON.stringify({ user_id: userId })
                }
            );

            if (res.status === 401 || res.status === 403) {
                console.log(res.status);
                alert(ALERT_MSG);
                return;
            }

            if (!res.ok) {
                const text = await res.text().catch(() => '');
                console.error('generateSentence failed', res.status, text);
                alert('ë¬¸ì¥ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            const data = await res.json();
            if (data && data.sentence) {
                // âœ… ìƒì„±ëœ ë¬¸ì¥ì„ ë³„ë„ ì˜ì—­ì— í‘œì‹œ
                if (generatedSentenceDiv) {
                    generatedSentenceDiv.textContent = data.sentence;
                }

                // âœ… ìƒì„±ëœ ë¬¸ì¥ë„ ìŒì„± ì¶œë ¥
                if (typeof speak === 'function') {
                    speak(data.sentence);
                }
            } else {
                console.warn('generateSentence: no sentence in response', data);
                // alert('ë¬¸ì¥ ìƒì„± ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }

            const endTime = performance.now();
            console.log("[Sentence] Generation finished at", endTime);
            console.log(`[Sentence] Total generation time: ${(endTime - startTime).toFixed(0)} ms`);

        } catch (err) {
            console.error('generateSentence error', err);
            alert('ë¬¸ì¥ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    async function reloadMotionCacheForCurrentUser() {
        const ALERT_MSG = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤(ë™ì‘ ìºì‹œë¥¼ ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”)";
        const userId = window.userId;  // index.jsì—ì„œ ì„¸íŒ…í•œ ê²ƒ ì‚¬ìš©

        if (!userId) {
            console.warn('[CacheReload] window.userIdê°€ ì—†ìŠµë‹ˆë‹¤.');
            alert(ALERT_MSG);
            return;
        }

        try {
            const res = await fetch(
                `${API_GATEWAY_URL_MODAL}/motions/users/${encodeURIComponent(userId)}/cache/reload`,
                {
                    method: 'POST',
                    credentials: 'include'
                }
            );

            if (!res.ok) {
                console.error('[CacheReload] failed', res.status);
                // ì‹¬ê°í•œ ì—ëŸ¬ ì•„ë‹ˆë©´ ì—¬ê¸°ì„œ alertê¹Œì§€ëŠ” ì•ˆ í•´ë„ OK
            } else {
                console.log('[CacheReload] cache reloaded for userId=', userId);
            }
        } catch (err) {
            console.error('[CacheReload] error', err);
        }
    }

    let autoSentenceTimer = null;

    function startAutoSentenceLoop() {
        if (autoSentenceTimer) return; // ì´ë¯¸ ëŒê³  ìˆìœ¼ë©´ ì¤‘ë³µ ì‹œì‘ ë°©ì§€

        autoSentenceTimer = setInterval(() => {
            // ì¸ì‹ êº¼ì ¸ ìˆìœ¼ë©´ êµ³ì´ í˜¸ì¶œ ì•ˆ í•¨
            // if (!window.detectionActive) return;

            // ìµœê·¼ 30ì´ˆ ë™ì•ˆ ìŒ“ì¸ phraseë“¤ë¡œ ë¬¸ì¥ ìƒì„± ìš”ì²­
            generateSentenceForCurrentUser();
        }, 10_000); // 10ì´ˆ
    }

    function stopAutoSentenceLoop() {
        if (autoSentenceTimer) {
            clearInterval(autoSentenceTimer);
            autoSentenceTimer = null;
        }
    }
</script>
